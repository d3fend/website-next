import{s as Y,b as S,e as E,j as v,d as I,f as j,i as h,w as A,k as w,p as M,y as Z,o as O,q as B,n as p,r as J,M as z,F as G,v as U,N as ee}from"../chunks/scheduler.BPS8Q4IK.js";import{h as K,u as te}from"../chunks/await_block.B3GDgYsA.js";import{S as ne,i as re,c as D,b as C,m as y,t as $,a as k,d as L,g as le,e as oe}from"../chunks/index.RHoRrSTo.js";import{w as _}from"../chunks/index.CUya3-XI.js";import{p as ae}from"../chunks/stores.CeDY58-m.js";import{b as se,g as F}from"../chunks/entry.DY9xS5Q0.js";import{L as ie,J as ce}from"../chunks/dialog.DoVWTud0.js";import{D as fe}from"../chunks/D3FMatrix.CzYMcSeM.js";import{T as ue}from"../chunks/Title.COl1UWhB.js";import{T as me}from"../chunks/Technique.C8ACay5h.js";import{L as pe,C as de,c as ge,P as _e}from"../chunks/combinedStore.Bc-UEfI6.js";import{t as he}from"../chunks/updateDefendTree.BuI9vq1U.js";import{l as W}from"../chunks/layers.BEw10rv0.js";function $e(o){let t,r;return t=new de({props:{slot:"drawer"}}),{c(){D(t.$$.fragment)},l(e){C(t.$$.fragment,e)},m(e,n){y(t,e,n),r=!0},p,i(e){r||($(t.$$.fragment,e),r=!0)},o(e){k(t.$$.fragment,e),r=!1},d(e){L(t,e)}}}function be(o){let t,r;return t=new fe({props:{treeStore:ge,theme:"main",slot:"matrix",scroll_indicator:!1}}),t.$on("elementClick",o[6]),{c(){D(t.$$.fragment)},l(e){C(t.$$.fragment,e)},m(e,n){y(t,e,n),r=!0},p,i(e){r||($(t.$$.fragment,e),r=!0)},o(e){k(t.$$.fragment,e),r=!1},d(e){L(t,e)}}}function ke(o){let t,r;return t=new _e({props:{slot:"legend"}}),{c(){D(t.$$.fragment)},l(e){C(t.$$.fragment,e)},m(e,n){y(t,e,n),r=!0},p,i(e){r||($(t.$$.fragment,e),r=!0)},o(e){k(t.$$.fragment,e),r=!1},d(e){L(t,e)}}}function qe(o){return{c:p,l:p,m:p,p,i:p,o:p,d:p}}function we(o){let t,r,e=o[3]&&x(o);return{c(){e&&e.c(),t=G()},l(n){e&&e.l(n),t=G()},m(n,i){e&&e.m(n,i),w(n,t,i),r=!0},p(n,i){n[3]?e?(e.p(n,i),i&8&&$(e,1)):(e=x(n),e.c(),$(e,1),e.m(t.parentNode,t)):e&&(le(),k(e,1,1,()=>{e=null}),oe())},i(n){r||($(e),r=!0)},o(n){k(e),r=!1},d(n){n&&h(t),e&&e.d(n)}}}function x(o){let t,r="esc",e,n,i,d,u;return n=new me({props:{technique_id:o[0].technique_id,technique:o[19]}}),{c(){t=E("button"),t.textContent=r,e=S(),D(n.$$.fragment)},l(l){t=I(l,"BUTTON",{"data-svelte-h":!0}),U(t)!=="svelte-1ejhv6h"&&(t.textContent=r),e=v(l),C(n.$$.fragment,l)},m(l,f){w(l,t,f),w(l,e,f),y(n,l,f),i=!0,d||(u=M(t,"click",ee(o[10])),d=!0)},p(l,f){const g={};f&1&&(g.technique_id=l[0].technique_id),f&8&&(g.technique=l[19]),n.$set(g)},i(l){i||($(n.$$.fragment,l),i=!0)},o(l){k(n.$$.fragment,l),i=!1},d(l){l&&(h(t),h(e)),L(n,l),d=!1,u()}}}function De(o){let t,r="loading...";return{c(){t=E("span"),t.textContent=r},l(e){t=I(e,"SPAN",{"data-svelte-h":!0}),U(t)!=="svelte-sermp4"&&(t.textContent=r)},m(e,n){w(e,t,n)},p,i:p,o:p,d(e){e&&h(t)}}}function Ce(o){let t,r,e,n,i,d,u,l,f,g,T,P;t=new ue({props:{title:"D3FEND Profile Studio",og_title:"D3FEND Profile Studio",og_type:"website",og_url:"https://d3fend.mitre.org/",og_image:"https://d3fend.mitre.org/img/d3fend-og.png",og_description:"D3FEND Profile Studio lets you organize and communicate your defensive cyber capabilities!"}}),e=new pe({props:{profileConfig:o[4],$$slots:{legend:[ke],matrix:[be],drawer:[$e]},$$scope:{ctx:o}}});let m={ctx:o,current:null,token:null,hasCatch:!1,pending:De,then:we,catch:qe,value:19,blocks:[,,,]};return K(d=o[3],m),f=new ie({}),{c(){D(t.$$.fragment),r=S(),D(e.$$.fragment),n=S(),i=E("dialog"),m.block.c(),u=S(),l=E("dialog"),D(f.$$.fragment),this.h()},l(a){C(t.$$.fragment,a),r=v(a),C(e.$$.fragment,a),n=v(a),i=I(a,"DIALOG",{class:!0});var c=j(i);m.block.l(c),c.forEach(h),u=v(a),l=I(a,"DIALOG",{class:!0});var b=j(l);C(f.$$.fragment,b),b.forEach(h),this.h()},h(){A(i,"class","technique-dialog"),A(l,"class","iframe-dialog")},m(a,c){y(t,a,c),w(a,r,c),y(e,a,c),w(a,n,c),w(a,i,c),m.block.m(i,m.anchor=null),m.mount=()=>i,m.anchor=null,o[11](i),w(a,u,c),w(a,l,c),y(f,l,null),o[13](l),g=!0,T||(P=[M(i,"close",o[12]),M(l,"close",o[14])],T=!0)},p(a,[c]){o=a;const b={};c&1048576&&(b.$$scope={dirty:c,ctx:o}),e.$set(b),m.ctx=o,c&8&&d!==(d=o[3])&&K(d,m)||te(m,o,c)},i(a){g||($(t.$$.fragment,a),$(e.$$.fragment,a),$(m.block),$(f.$$.fragment,a),g=!0)},o(a){k(t.$$.fragment,a),k(e.$$.fragment,a);for(let c=0;c<3;c+=1){const b=m.blocks[c];k(b)}k(f.$$.fragment,a),g=!1},d(a){a&&(h(r),h(n),h(i),h(u),h(l)),L(t,a),L(e,a),m.block.d(),m.token=null,m=null,o[11](null),L(f),o[13](null),T=!1,Z(P)}}}function ye(o,t,r){let e,n,i;O(o,ae,s=>r(9,n=s)),O(o,W,s=>r(17,i=s));let{data:d}=t,u,l,f,g=null,T=!1;const P={expanded:_({}),expandedTechniques:_({}),selected:_({}),editingName:_(""),isCreateLayerDialogOpen:_(!1),colorPicker:_({}),selectedD3fendId:_(null),selectedLayerId:_(null),selectedTechnique:_(null),selectedLayerColor:_("#e1e1e1"),mappings:_(!0)},{selectedD3fendId:m}=P;O(o,m,s=>r(16,e=s)),B(()=>{if(window.location!==window.parent.location&&(T=!0),!T&&i.localStorageWarning&&f.showModal(),r(8,u=document.getElementsByTagName("body")[0]),n.url.searchParams.get("technique_id")){const s=n.url.searchParams.get("technique_id");s&&(r(3,g=b(d.technique_id)),F(`/profile/maps/?technique_id=${s}`))}if(n.url.searchParams.get("profile")){const s=n.url.searchParams.get("profile"),q=ce.uncrush(s),N=JSON.parse(q);J(W,i=N,i)}}),se(()=>{u==null||u.classList.remove("scroll--none")});const a=s=>{const q=s.detail.element["@id"];if(!s.detail.event.ctrlKey&&!s.detail.event.metaKey){J(m,e=q,e),r(3,g=b(q)),F(`/profile/maps/?technique_id=${q}`);return}he.selectTechnique(q)},c=s=>{s.close(),F("/profile/maps/")},b=async s=>{const q=await fetch(`/api/technique/${s}.json`),N=await q.json();if(q.ok)return N;throw new Error(N)},H=()=>c(l);function Q(s){z[s?"unshift":"push"](()=>{l=s,r(1,l)})}const R=()=>c(l);function V(s){z[s?"unshift":"push"](()=>{f=s,r(2,f)})}const X=()=>c(f);return o.$$set=s=>{"data"in s&&r(0,d=s.data)},o.$$.update=()=>{o.$$.dirty&770&&(l&&n.url.searchParams.size?(l.showModal(),u==null||u.classList.add("scroll--none")):l&&(l.close(),u==null||u.classList.remove("scroll--none")))},[d,l,f,g,P,m,a,c,u,n,H,Q,R,V,X]}class Je extends ne{constructor(t){super(),re(this,t,ye,Ce,Y,{data:0})}}export{Je as component};
