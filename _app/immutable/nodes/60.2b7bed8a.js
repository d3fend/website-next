import{s as fe,f as C,M as De,l as ae,g as $,h as j,N as Le,m as ce,d as g,j as m,E as x,k as Y,i as q,x as b,C as Q,n as ve,y as J,a7 as ft,a as A,c as S,F as le,a6 as dt,D as ge,z as oe,p as _e,r as be,e as ue,u as ke,v as we,w as Ce,ak as ye,H as Me,a8 as vt,A as bt,B as te,G as pt,o as kt}from"../chunks/scheduler.3032ca4b.js";import{h as Ze,u as wt}from"../chunks/await_block.99b27d44.js";import{S as Ct,g as $t}from"../chunks/SimpleAutocomplete.60cf9111.js";import{S as me,i as he,a as M,g as de,t as y,c as pe,p as ie,f as Mt,b as z,d as H,m as U,e as B,h as Et,j as Nt}from"../chunks/index.ee8739bf.js";import{p as It}from"../chunks/stores.d44548c4.js";import{b as Tt,g as qe}from"../chunks/navigation.efa10daf.js";import{a as $e,f as Oe,s as Fe}from"../chunks/index.4dcc05a9.js";import{d as Dt,w as Lt}from"../chunks/index.e2937cfb.js";import{f as yt}from"../chunks/consts.4dd69edc.js";import{T as Ot,a as se}from"../chunks/updateDefendTree.85968da5.js";/* empty css                             */import{e as je}from"../chunks/each.6507e059.js";import{D as jt}from"../chunks/D3FMatrix.f7f5e2a9.js";import{T as Pt}from"../chunks/Title.8f901ed1.js";import{T as qt}from"../chunks/Technique.f7e72b6d.js";const ze={setting:"M19.5 12c0 .34-.03.66-.07.98l2.11 1.65c.19.15.24.42.12.64l-2 3.46c-.12.22-.38.31-.61.22l-2.49-1c-.52.39-1.08.73-1.69.98l-.38 2.65c-.03.24-.24.42-.49.42h-4c-.25 0-.46-.18-.49-.42l-.38-2.65c-.61-.25-1.17-.58-1.69-.98l-2.49 1c-.22.08-.49 0-.61-.22l-2-3.46a.505.505 0 0 1 .12-.64l2.11-1.65A7.93 7.93 0 0 1 4.5 12c0-.33.03-.66.07-.98L2.46 9.37a.493.493 0 0 1-.12-.64l2-3.46c.12-.22.38-.31.61-.22l2.49 1c.52-.39 1.08-.73 1.69-.98l.38-2.65c.03-.24.24-.42.49-.42h4c.25 0 .46.18.49.42l.38 2.65c.61.25 1.17.58 1.69.98l2.49-1c.22-.08.49 0 .61.22l2 3.46c.12.22.07.49-.12.64l-2.11 1.65c.04.32.07.64.07.98Zm-11 0c0 1.93 1.57 3.5 3.5 3.5s3.5-1.57 3.5-3.5-1.57-3.5-3.5-3.5-3.5 1.57-3.5 3.5Z","color picker":"M12 3a9 9 0 0 0 0 18c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8Zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12ZM8 6.5C8 7.33 8.67 8 9.5 8S11 7.33 11 6.5 10.33 5 9.5 5 8 5.67 8 6.5ZM14.5 8c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8Zm1.5 2.5c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5S18.33 9 17.5 9s-1.5.67-1.5 1.5Z",create:"M20.71 5.63c.39.39.39 1.02 0 1.41l-1.83 1.83-3.75-3.75 1.83-1.83a.996.996 0 0 1 1.41 0l2.34 2.34ZM3 20.5v-3.04c0-.14.05-.26.15-.36L14.06 6.19l3.75 3.75L6.89 20.85a.47.47 0 0 1-.35.15H3.5c-.28 0-.5-.22-.5-.5Z",delete:"M15.5 4H18c.55 0 1 .45 1 1s-.45 1-1 1H6c-.55 0-1-.45-1-1s.45-1 1-1h2.5l.71-.71c.18-.18.44-.29.7-.29h4.18c.26 0 .52.11.7.29l.71.71ZM8 21c-1.1 0-2-.9-2-2V9c0-1.1.9-2 2-2h8c1.1 0 2 .9 2 2v10c0 1.1-.9 2-2 2H8Z","create portfolio":"M12 6h8c1.1 0 2 .9 2 2v10c0 1.1-.9 2-2 2H4c-1.11 0-2-.89-2-2l.01-12c0-1.11.88-2 1.99-2h5.17c.53 0 1.04.21 1.42.59L12 6Zm4 8h2c.55 0 1-.45 1-1s-.45-1-1-1h-2v-2c0-.55-.45-1-1-1s-1 .45-1 1v2h-2c-.55 0-1 .45-1 1s.45 1 1 1h2v2c0 .55.45 1 1 1s1-.45 1-1v-2Z",heatmap:"M10.5 2A3.5 3.5 0 0 1 14 5.5v6.758a5.5 5.5 0 1 1-7 0V5.499A3.5 3.5 0 0 1 10.5 2Zm0 2a1.5 1.5 0 0 0-1.493 1.355L9 5.5v7.699l-.726.6a3.5 3.5 0 1 0 4.609.137l-.156-.136-.726-.6L12 5.5a1.5 1.5 0 0 0-1.355-1.493L10.5 4Zm.5 1.5a.5.5 0 0 0-1 0v8.55a2.5 2.5 0 1 0 1 0V5.5Zm9 5.5a1 1 0 1 1 0 2h-3a1 1 0 1 1 0-2h3Zm-1-2a1 1 0 0 0-1-1h-1a1 1 0 1 0 0 2h1a1 1 0 0 0 1-1Zm1-4a1 1 0 1 1 0 2h-3a1 1 0 1 1 0-2h3Zm-1-2a1 1 0 0 0-1-1h-1a1 1 0 1 0 0 2h1a1 1 0 0 0 1-1Z",multicolor:"M6.34 19.24c-3.12-3.12-3.12-8.19 0-11.31l4.96-4.95a.996.996 0 0 1 1.41 0l4.95 4.95c3.12 3.12 3.12 8.19 0 11.31A7.98 7.98 0 0 1 12 21.58c-2.05 0-4.1-.78-5.66-2.34Zm1.42-1.41A5.928 5.928 0 0 0 12 19.59V5.1L7.76 9.35A5.928 5.928 0 0 0 6 13.59c0 1.6.62 3.1 1.76 4.24Z",info:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2Zm0 15c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1s1 .45 1 1v4c0 .55-.45 1-1 1Zm-1-8h2V7h-2v2Z",plus:"M18 13h-5v5c0 .55-.45 1-1 1s-1-.45-1-1v-5H6c-.55 0-1-.45-1-1s.45-1 1-1h5V6c0-.55.45-1 1-1s1 .45 1 1v5h5c.55 0 1 .45 1 1s-.45 1-1 1Z"};function At(l){let e,n,t,s,o,i,f,c,d,a;return{c(){e=C("button"),n=De("svg"),t=De("title"),s=ae(l[2]),o=De("path"),f=De("metadata"),c=ae(l[2]),this.h()},l(r){e=$(r,"BUTTON",{style:!0,"data-icon":!0,class:!0,title:!0,"aria-label":!0});var u=j(e);n=Le(u,"svg",{xmlns:!0,viewBox:!0,class:!0});var p=j(n);t=Le(p,"title",{});var h=j(t);s=ce(h,l[2]),h.forEach(g),o=Le(p,"path",{"fill-rule":!0,d:!0}),j(o).forEach(g),f=Le(p,"metadata",{});var O=j(f);c=ce(O,l[2]),O.forEach(g),p.forEach(g),u.forEach(g),this.h()},h(){m(o,"fill-rule","evenodd"),m(o,"d",i=ze[l[1]]),m(n,"xmlns","http://www.w3.org/2000/svg"),m(n,"viewBox","0 0 24 24"),m(n,"class","svelte-1j3ecg"),x(n,"icon-disabled",l[3]),Y(e,"--size",l[0]),m(e,"data-icon",l[1]),m(e,"class","fab svelte-1j3ecg"),m(e,"title",l[2]),m(e,"aria-label",l[2]),e.disabled=l[3]},m(r,u){q(r,e,u),b(e,n),b(n,t),b(t,s),b(n,o),b(n,f),b(f,c),d||(a=Q(e,"click",l[4]),d=!0)},p(r,[u]){u&4&&ve(s,r[2]),u&2&&i!==(i=ze[r[1]])&&m(o,"d",i),u&4&&ve(c,r[2]),u&8&&x(n,"icon-disabled",r[3]),u&1&&Y(e,"--size",r[0]),u&2&&m(e,"data-icon",r[1]),u&4&&m(e,"title",r[2]),u&4&&m(e,"aria-label",r[2]),u&8&&(e.disabled=r[3])},i:J,o:J,d(r){r&&g(e),d=!1,a()}}}function St(l,e,n){let{size:t}=e,{iconName:s}=e,{description:o}=e,{disabled:i=!1}=e;const f=new ft,c=()=>{f("iconClick")};return l.$$set=d=>{"size"in d&&n(0,t=d.size),"iconName"in d&&n(1,s=d.iconName),"description"in d&&n(2,o=d.description),"disabled"in d&&n(3,i=d.disabled)},[t,s,o,i,c]}class re extends me{constructor(e){super(),he(this,e,St,At,fe,{size:0,iconName:1,description:2,disabled:3})}}const Vt=(l,e)=>{const n={max:0,count:{},highlighted:{}};return Dt([l,e],([t,s],o)=>{var d;if(!(s!=null&&s.tree.length)||!l){o(Ot);return}n.count={},n.highlighted=Object.entries(n.highlighted).reduce((a,[r,u])=>(a[r]=!1,a),{});const{highlightedTechniques:i,techniqueColors:f}=mt((d=t==null?void 0:t.portfolios[t.selectedPortfolio])==null?void 0:d.includedMeasures,t.measures),c=Object.entries(f).reduce((a,[r,u])=>(a[r]=[...new Set(u)],a),{});i.forEach(a=>{n.highlighted[a]=!0,n.count[a]?n.count[a]+=1:n.count[a]=1}),n.max=Object.values(n.count).reduce((a,r)=>a>r?a:r,-1/0),Object.entries(n.highlighted).forEach(([a,r])=>{if(r){const u=zt[t.techniqueMappingMode]({colors:c[a],count:n.count,max:n.max,technique:a});s.treeMap[a].classes.isHighlighted=!0,s.treeMap[a].classes.color=u}else s.treeMap[a].classes.isHighlighted=!1,s.treeMap[a].classes.color=null}),o(s)})},Zt=l=>{const{colors:e}=l,n=e.length,t=n-1,s=(1/n*100).toFixed(1);if(n===1)return e[0];let o="linear-gradient( to right,";for(let i=0;i<n;i++){const f=e[i];if(i===0){o+=` ${f} ${s}%`;continue}if(i===t){o+=`, ${f} ${s*t}%`;continue}o+=`, ${f} ${s*i}% ${s*(i+1)}%`}return o+=")",o},Ft=l=>{const{count:e,max:n,technique:t}=l,s=e[t]/n*100;return`color-mix(in srgb, green ${s<20?20:s}%, white)`},zt={multiColor:l=>Zt(l),heatMap:l=>Ft(l)},mt=(l=[],e,n=[],t={},s="#0075FF")=>{for(let o=0;o<l.length;o++){const i=e[l[o]];i.checked&&(n.push(...i.techniques),i.techniques.forEach(f=>{(t[f]||(t[f]=[]))&&t[f].push(i.color||s)})),i.children&&mt(i.children,e,n,t,i.color||s)}return{highlightedTechniques:n,techniqueColors:t}};var Ae={};function Ht(l){return l==="local"?localStorage:sessionStorage}function Ut(l,e,n){var t,s;const o=(t=n==null?void 0:n.serializer)!=null?t:JSON,i=(s=n==null?void 0:n.storage)!=null?s:"local",f=typeof window<"u"&&typeof document<"u",c=f?Ht(i):null;function d(a,r){c==null||c.setItem(a,o.stringify(r))}if(!Ae[l]){const a=Lt(e,p=>{const h=c==null?void 0:c.getItem(l);if(h?p(o.parse(h)):d(l,e),f){const O=_=>{_.key===l&&p(_.newValue?o.parse(_.newValue):null)};return window.addEventListener("storage",O),()=>window.removeEventListener("storage",O)}}),{subscribe:r,set:u}=a;Ae[l]={set(p){d(l,p),u(p)},update(p){return a.update(h=>{const O=p(h);return d(l,O),O})},subscribe:r}}return Ae[l]}const Bt=()=>{const{subscribe:l,update:e,set:n}=Ut("d3fend-measures",yt);return{subscribe:l,update:e,set:n,createPortfolio:r=>e(u=>{const p=u.portfolios.length;return r.id=p,r.includedMeasures=[],u.portfolios.push(r),u.selectedPortfolio=p,u}),deletePortfolio:()=>e(r=>(r.portfolios=r.portfolios.filter((u,p)=>p!==r.selectedPortfolio),r.selectedPortfolio=r.portfolios.length?0:null,r)),addMeasure:r=>e(u=>{var h;const p=r.name.toLowerCase();return r.id=((h=Object.values(u.measures))==null?void 0:h.length)+1,r.techniques=[],r.checked=!1,r.color="#0075FF",u.measures[p]=r,u.portfolios[u.selectedPortfolio].includedMeasures.push(p),u}),addChild:(r,u)=>e(p=>{var D;const h=((D=Object.values(p.measures))==null?void 0:D.length)||0,O=u.name.toLowerCase(),_=r.name.toLowerCase();return u.id=h+1,u.checked=!0,u.techniques=[...r.techniques],p.measures[O]=u,p.measures[_].children||(p.measures[_].children=[]),p.measures[_].children.push(O),p.measures[_].techniques=[],p}),deleteMeasure:r=>e(u=>{const p=u.selectedPortfolio;return u.portfolios=u.portfolios.reduce((h,O,_)=>{if(p===_){const D={...O};D.includedMeasures=D.includedMeasures.filter(w=>w!==r.name.toLowerCase()),h.push(D)}else h.push({...O});return h},[]),u}),deleteSubmeasure:(r,u)=>e(p=>{const h=r.name.toLowerCase();return p.measures[h].children=p.measures[h].children.filter(O=>O!==u.name.toLowerCase()),p}),saveTechniques:(r,u)=>e(p=>{const h=Object.values(r).reduce((_,D)=>(D.classes.isSelected&&_.push(D["@id"]),_),[]);return Object.entries(u).reduce((_,[D,w])=>(w&&_.push(D),_),[]).forEach(_=>{const D=[...new Set([...p.measures[_].techniques,...h])];p.measures[_].techniques=D,p.measures[_].checked=!0}),p}),saveMeasureColor:(r,u)=>e(p=>(p.measures[r.name.toLowerCase()].color=u,p))}},G=Bt();function He(l){var s;let e,n=((s=l[0])==null?void 0:s.name)+"",t;return{c(){e=C("h3"),t=ae(n),this.h()},l(o){e=$(o,"H3",{class:!0});var i=j(e);t=ce(i,n),i.forEach(g),this.h()},h(){m(e,"class","text-center")},m(o,i){q(o,e,i),b(e,t)},p(o,i){var f;i&1&&n!==(n=((f=o[0])==null?void 0:f.name)+"")&&ve(t,n)},d(o){o&&g(e)}}}function Rt(l){let e,n,t,s,o,i,f,c="<p>NAME</p>",d,a,r,u,p="<p>Description</p>",h,O,_,D,w,E="Save",N,v,I,Z="Cancel",R,X,T=l[0]&&He(l);return{c(){e=C("h2"),n=ae(l[1]),t=A(),T&&T.c(),s=A(),o=C("div"),i=C("form"),f=C("label"),f.innerHTML=c,d=A(),a=C("input"),r=A(),u=C("label"),u.innerHTML=p,h=A(),O=C("textarea"),_=A(),D=C("section"),w=C("button"),w.textContent=E,N=A(),v=C("form"),I=C("button"),I.textContent=Z,this.h()},l(k){e=$(k,"H2",{class:!0});var V=j(e);n=ce(V,l[1]),V.forEach(g),t=S(k),T&&T.l(k),s=S(k),o=$(k,"DIV",{id:!0,class:!0});var W=j(o);i=$(W,"FORM",{class:!0,autocomplete:!0});var K=j(i);f=$(K,"LABEL",{"aria-label":!0,for:!0,"data-svelte-h":!0}),le(f)!=="svelte-106jfu"&&(f.innerHTML=c),d=S(K),a=$(K,"INPUT",{id:!0,type:!0,name:!0,class:!0,"aria-describedby":!0,oninvalid:!0}),r=S(K),u=$(K,"LABEL",{"aria-label":!0,for:!0,"data-svelte-h":!0}),le(u)!=="svelte-1s39tqs"&&(u.innerHTML=p),h=S(K),O=$(K,"TEXTAREA",{id:!0,name:!0,class:!0}),j(O).forEach(g),_=S(K),D=$(K,"SECTION",{id:!0,class:!0});var ee=j(D);w=$(ee,"BUTTON",{type:!0,"data-svelte-h":!0}),le(w)!=="svelte-1f2bxem"&&(w.textContent=E),N=S(ee),v=$(ee,"FORM",{method:!0});var ne=j(v);I=$(ne,"BUTTON",{"data-svelte-h":!0}),le(I)!=="svelte-ve2mbs"&&(I.textContent=Z),ne.forEach(g),ee.forEach(g),K.forEach(g),W.forEach(g),this.h()},h(){m(e,"class","text-center"),m(f,"aria-label","-measure input"),m(f,"for","measure-name"),m(a,"id","measure-name"),m(a,"type","text"),m(a,"name","Measure"),m(a,"class","measure-input svelte-lxji7x"),a.required=!0,m(a,"aria-describedby","measurename-error"),m(a,"oninvalid",l[3]("This field is required.")),m(u,"aria-label","-measure input"),m(u,"for","measure-input"),m(O,"id","measure-description"),m(O,"name","Description"),m(O,"class","measure-input svelte-lxji7x"),O.required=!0,m(w,"type","submit"),m(v,"method","dialog"),m(D,"id","measure-btns"),m(D,"class","svelte-lxji7x"),m(i,"class","measure-input-form svelte-lxji7x"),m(i,"autocomplete","off"),m(o,"id","container-measure-form"),m(o,"class","svelte-lxji7x")},m(k,V){q(k,e,V),b(e,n),q(k,t,V),T&&T.m(k,V),q(k,s,V),q(k,o,V),b(o,i),b(i,f),b(i,d),b(i,a),b(i,r),b(i,u),b(i,h),b(i,O),b(i,_),b(i,D),b(D,w),b(D,N),b(D,v),b(v,I),l[8](i),R||(X=[Q(I,"click",l[7]),Q(i,"submit",dt(l[4]))],R=!0)},p(k,[V]){V&2&&ve(n,k[1]),k[0]?T?T.p(k,V):(T=He(k),T.c(),T.m(s.parentNode,s)):T&&(T.d(1),T=null)},i:J,o:J,d(k){k&&(g(e),g(t),g(s),g(o)),T&&T.d(k),l[8](null),R=!1,ge(X)}}}function Gt(l,e,n){let t;oe(l,G,h=>n(9,t=h));let{dialog:s}=e,{parent:o}=e,{title:i}=e,{dispatchName:f="dispatch"}=e,c;const d=new ft,a=h=>{},r=h=>{const O=h.target,_=new FormData(O),D=String(_.get("Measure")),w=String(_.get("Description")),E=D.toLocaleLowerCase();if(t.measures[E]){alert("Name must be unique");return}d(f,{dialogSubmitObject:{id:null,name:D,description:w},parent:o}),c.reset(),s.close()},u=()=>c.reset();function p(h){_e[h?"unshift":"push"](()=>{c=h,n(2,c)})}return l.$$set=h=>{"dialog"in h&&n(5,s=h.dialog),"parent"in h&&n(0,o=h.parent),"title"in h&&n(1,i=h.title),"dispatchName"in h&&n(6,f=h.dispatchName)},[o,i,c,a,r,s,f,u,p]}class Se extends me{constructor(e){super(),he(this,e,Gt,Rt,fe,{dialog:5,parent:0,title:1,dispatchName:6})}}const Kt=l=>({}),Ue=l=>({}),Jt=l=>({}),Be=l=>({});function Re(l){let e,n,t,s,o,i,f,c,d;const a=l[6].popover,r=be(a,l,l[5],Ue);return{c(){e=C("div"),n=C("div"),s=A(),o=C("div"),r&&r.c(),this.h()},l(u){e=$(u,"DIV",{role:!0,"aria-labelledby":!0,"aria-describedby":!0,class:!0,style:!0});var p=j(e);n=$(p,"DIV",{class:!0}),j(n).forEach(g),s=S(p),o=$(p,"DIV",{class:!0});var h=j(o);r&&r.l(h),h.forEach(g),p.forEach(g),this.h()},h(){m(n,"class","backdrop svelte-odell5"),m(o,"class","wrapper svelte-odell5"),m(e,"role","dialog"),m(e,"aria-labelledby","Title"),m(e,"aria-describedby","Description"),m(e,"class","popover svelte-odell5"),Y(e,"--popover-top",`${l[2]}px`),Y(e,"--popover-left",`${l[3]}px`)},m(u,p){q(u,e,p),b(e,n),b(e,s),b(e,o),r&&r.m(o,null),f=!0,c||(d=[Q(n,"click",ye(l[10])),Q(e,"click",ye(l[7]))],c=!0)},p(u,p){r&&r.p&&(!f||p&32)&&ke(r,a,u,u[5],f?Ce(a,u[5],p,Kt):we(u[5]),Ue),(!f||p&4)&&Y(e,"--popover-top",`${u[2]}px`),(!f||p&8)&&Y(e,"--popover-left",`${u[3]}px`)},i(u){f||(u&&Me(()=>{f&&(t||(t=ie(n,$e,{delay:25,duration:150},!0)),t.run(1))}),M(r,u),u&&Me(()=>{f&&(i||(i=ie(e,$e,{},!0)),i.run(1))}),f=!0)},o(u){u&&(t||(t=ie(n,$e,{delay:25,duration:150},!1)),t.run(0)),y(r,u),u&&(i||(i=ie(e,$e,{},!1)),i.run(0)),f=!1},d(u){u&&g(e),u&&t&&t.end(),r&&r.d(u),u&&i&&i.end(),c=!1,ge(d)}}}function Qt(l){let e,n,t,s,o,i;const f=l[6].popoverClick,c=be(f,l,l[5],Be);let d=l[1]&&Re(l);return{c(){e=C("div"),c&&c.c(),n=A(),d&&d.c(),t=ue()},l(a){e=$(a,"DIV",{});var r=j(e);c&&c.l(r),r.forEach(g),n=S(a),d&&d.l(a),t=ue()},m(a,r){q(a,e,r),c&&c.m(e,null),l[9](e),q(a,n,r),d&&d.m(a,r),q(a,t,r),s=!0,o||(i=[Q(window,"resize",l[4]),Q(e,"click",l[8])],o=!0)},p(a,[r]){c&&c.p&&(!s||r&32)&&ke(c,f,a,a[5],s?Ce(f,a[5],r,Jt):we(a[5]),Be),a[1]?d?(d.p(a,r),r&2&&M(d,1)):(d=Re(a),d.c(),M(d,1),d.m(t.parentNode,t)):d&&(de(),y(d,1,1,()=>{d=null}),pe())},i(a){s||(M(c,a),M(d),s=!0)},o(a){y(c,a),y(d),s=!1},d(a){a&&(g(e),g(n),g(t)),c&&c.d(a),l[9](null),d&&d.d(a),o=!1,ge(i)}}}function Xt(l,e,n){let{$$slots:t={},$$scope:s}=e,o=!1,i,f,c;const d=()=>setTimeout(()=>{n(2,{bottom:f,left:c}=(i==null?void 0:i.getBoundingClientRect())??{bottom:0,left:0},f,n(3,c))},1e3);function a(h){vt.call(this,l,h)}const r=()=>n(1,o=!0);function u(h){_e[h?"unshift":"push"](()=>{i=h,n(0,i)})}const p=()=>n(1,o=!1);return l.$$set=h=>{"$$scope"in h&&n(5,s=h.$$scope)},l.$$.update=()=>{l.$$.dirty&1&&d()},[i,o,f,c,d,s,t,a,r,u,p]}class Wt extends me{constructor(e){super(),he(this,e,Xt,Qt,fe,{})}}function Yt(l){let e,n;return e=new re({props:{size:30,iconName:"setting",description:"Change Layout",slot:"popoverClick"}}),{c(){z(e.$$.fragment)},l(t){H(e.$$.fragment,t)},m(t,s){U(e,t,s),n=!0},p:J,i(t){n||(M(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function xt(l){let e,n,t,s,o,i="Heatmap",f,c,d,a,r,u="Multi-Colored",p,h,O;return t=new re({props:{size:30,iconName:"heatmap",description:"Heatmap"}}),d=new re({props:{size:30,iconName:"multicolor",description:"MultiColor"}}),{c(){e=C("div"),n=C("button"),z(t.$$.fragment),s=A(),o=C("span"),o.textContent=i,f=A(),c=C("button"),z(d.$$.fragment),a=A(),r=C("span"),r.textContent=u,this.h()},l(_){e=$(_,"DIV",{id:!0,slot:!0,class:!0});var D=j(e);n=$(D,"BUTTON",{class:!0});var w=j(n);H(t.$$.fragment,w),s=S(w),o=$(w,"SPAN",{class:!0,"data-svelte-h":!0}),le(o)!=="svelte-1cpq3q6"&&(o.textContent=i),w.forEach(g),f=S(D),c=$(D,"BUTTON",{class:!0});var E=j(c);H(d.$$.fragment,E),a=S(E),r=$(E,"SPAN",{class:!0,"data-svelte-h":!0}),le(r)!=="svelte-17kog5w"&&(r.textContent=u),E.forEach(g),D.forEach(g),this.h()},h(){m(o,"class","pop-text"),m(n,"class","btn svelte-bsc48l"),m(r,"class","pop-text"),m(c,"class","btn svelte-bsc48l"),m(e,"id","btn-group"),m(e,"slot","popover"),m(e,"class","svelte-bsc48l")},m(_,D){q(_,e,D),b(e,n),U(t,n,null),b(n,s),b(n,o),b(e,f),b(e,c),U(d,c,null),b(c,a),b(c,r),p=!0,h||(O=[Q(n,"click",l[16]),Q(c,"click",l[17])],h=!0)},p:J,i(_){p||(M(t.$$.fragment,_),M(d.$$.fragment,_),p=!0)},o(_){y(t.$$.fragment,_),y(d.$$.fragment,_),p=!1},d(_){_&&g(e),B(t),B(d),h=!1,ge(O)}}}function el(l){var T;let e,n,t="D3FEND PROFILE",s,o,i,f,c,d,a,r,u,p,h,O,_,D,w,E,N,v,I,Z;i=new re({props:{size:33,iconName:"create portfolio",description:"Create Portfolio"}}),i.$on("iconClick",l[11]);function R(k){l[13](k)}let X={inputClassName:"autocomplete-cursor-select",items:(T=l[3])==null?void 0:T.portfolios,readonly:!1,labelFieldName:"name",onChange:l[12]};return l[2]!==void 0&&(X.selectedItem=l[2]),c=new Ct({props:X}),_e.push(()=>Mt(c,"selectedItem",R)),u=new re({props:{size:33,iconName:"plus",description:"Create Capability",disabled:!l[3].portfolios.length>0}}),u.$on("iconClick",l[14]),h=new re({props:{size:33,iconName:"delete",description:"Delete Portfolio"}}),h.$on("iconClick",l[15]),_=new Wt({props:{$$slots:{popover:[xt],popoverClick:[Yt]},$$scope:{ctx:l}}}),E=new Se({props:{dialog:l[0],title:"Create Capability"}}),E.$on("dispatch",l[18]),I=new Se({props:{dialog:l[1],title:"Create Portfolio"}}),I.$on("dispatch",l[20]),{c(){e=C("section"),n=C("h2"),n.textContent=t,s=A(),o=C("div"),z(i.$$.fragment),f=A(),z(c.$$.fragment),a=A(),r=C("div"),z(u.$$.fragment),p=A(),z(h.$$.fragment),O=A(),z(_.$$.fragment),D=A(),w=C("dialog"),z(E.$$.fragment),N=A(),v=C("dialog"),z(I.$$.fragment),this.h()},l(k){e=$(k,"SECTION",{id:!0,class:!0});var V=j(e);n=$(V,"H2",{class:!0,"data-svelte-h":!0}),le(n)!=="svelte-j94ybk"&&(n.textContent=t),s=S(V),o=$(V,"DIV",{id:!0,class:!0});var W=j(o);H(i.$$.fragment,W),f=S(W),H(c.$$.fragment,W),a=S(W),r=$(W,"DIV",{id:!0,class:!0});var K=j(r);H(u.$$.fragment,K),p=S(K),H(h.$$.fragment,K),O=S(K),H(_.$$.fragment,K),K.forEach(g),W.forEach(g),V.forEach(g),D=S(k),w=$(k,"DIALOG",{});var ee=j(w);H(E.$$.fragment,ee),ee.forEach(g),N=S(k),v=$(k,"DIALOG",{});var ne=j(v);H(I.$$.fragment,ne),ne.forEach(g),this.h()},h(){m(n,"class","text-center fancy-font"),m(r,"id","measure-btns"),m(r,"class","svelte-bsc48l"),m(o,"id","portfolio-controls"),m(o,"class","svelte-bsc48l"),m(e,"id","container-portfolio"),m(e,"class","svelte-bsc48l")},m(k,V){q(k,e,V),b(e,n),b(e,s),b(e,o),U(i,o,null),b(o,f),U(c,o,null),b(o,a),b(o,r),U(u,r,null),b(r,p),U(h,r,null),b(r,O),U(_,r,null),q(k,D,V),q(k,w,V),U(E,w,null),l[19](w),q(k,N,V),q(k,v,V),U(I,v,null),l[21](v),Z=!0},p(k,[V]){var Ie;const W={};V&8&&(W.items=(Ie=k[3])==null?void 0:Ie.portfolios),!d&&V&4&&(d=!0,W.selectedItem=k[2],bt(()=>d=!1)),c.$set(W);const K={};V&8&&(K.disabled=!k[3].portfolios.length>0),u.$set(K);const ee={};V&4194304&&(ee.$$scope={dirty:V,ctx:k}),_.$set(ee);const ne={};V&1&&(ne.dialog=k[0]),E.$set(ne);const Ne={};V&2&&(Ne.dialog=k[1]),I.$set(Ne)},i(k){Z||(M(i.$$.fragment,k),M(c.$$.fragment,k),M(u.$$.fragment,k),M(h.$$.fragment,k),M(_.$$.fragment,k),M(E.$$.fragment,k),M(I.$$.fragment,k),Z=!0)},o(k){y(i.$$.fragment,k),y(c.$$.fragment,k),y(u.$$.fragment,k),y(h.$$.fragment,k),y(_.$$.fragment,k),y(E.$$.fragment,k),y(I.$$.fragment,k),Z=!1},d(k){k&&(g(e),g(D),g(w),g(N),g(v)),B(i),B(c),B(u),B(h),B(_),B(E),l[19](null),B(I),l[21](null)}}}function tl(l,e,n){var X;let t;oe(l,G,T=>n(3,t=T));let s,o,i=((X=t==null?void 0:t.portfolios)==null?void 0:X[t==null?void 0:t.selectedPortfolio])||null;const f=T=>{var k;if(T){const V=t.portfolios.findIndex(({id:W})=>W===T.id);te(G,t.selectedPortfolio=V,t),n(2,i=((k=t==null?void 0:t.portfolios)==null?void 0:k[V])||null),se.reset()}else te(G,t.selectedPortfolio=null,t),n(2,i=T)},c=()=>{o.showModal()},d=T=>{s.showModal()},a=T=>{const{dialogSubmitObject:k}=T.detail;G.addMeasure(k)},r=T=>{const{dialogSubmitObject:k}=T.detail;G.createPortfolio(k),n(2,i=t.portfolios[t.selectedPortfolio]||null)},u=T=>{confirm("Deleting Portfolio will delete whole portfolio.")&&(G.deletePortfolio(),n(2,i=t.portfolios[t.selectedPortfolio]||{name:""}))},p=T=>{te(G,t.techniqueMappingMode=T,t)},h=T=>c(),O=T=>f(T);function _(T){i=T,n(2,i)}const D=T=>d(),w=T=>u(),E=()=>p("heatMap"),N=()=>p("multiColor"),v=T=>a(T);function I(T){_e[T?"unshift":"push"](()=>{s=T,n(0,s)})}const Z=T=>r(T);function R(T){_e[T?"unshift":"push"](()=>{o=T,n(1,o)})}return[s,o,i,t,f,c,d,a,r,u,p,h,O,_,D,w,E,N,v,I,Z,R]}class ll extends me{constructor(e){super(),he(this,e,tl,el,fe,{})}}function Ge(l,e,n){const t=l.slice();return t[6]=e[n],t[8]=n,t}const nl=l=>({capability:l&512,parent:l&5,level:l&2,idx:l&256}),Ke=l=>({capability:l[9],parent:l[6],level:l[1],idx:l[8]}),sl=l=>({capability:l&5,level:l&2}),Je=l=>({parent:null,capability:l[6],level:l[1],idx:l[8]});function il(l){let e;return{c(){e=ae("No slot")},l(n){e=ce(n,"No slot")},m(n,t){q(n,e,t)},d(n){n&&g(e)}}}function Qe(l){let e,n;return e=new ht({props:{capabilities:l[6].children,level:l[1]+1,$$slots:{default:[rl,({capability:t,level:s,idx:o})=>({9:t,1:s,8:o}),({capability:t,level:s,idx:o})=>(t?512:0)|(s?2:0)|(o?256:0)]},$$scope:{ctx:l}}}),{c(){z(e.$$.fragment)},l(t){H(e.$$.fragment,t)},m(t,s){U(e,t,s),n=!0},p(t,s){const o={};s&5&&(o.capabilities=t[6].children),s&2&&(o.level=t[1]+1),s&807&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){n||(M(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function ol(l){let e;return{c(){e=ae("No slot")},l(n){e=ce(n,"No slot")},m(n,t){q(n,e,t)},d(n){n&&g(e)}}}function Xe(l){let e;const n=l[3].default,t=be(n,l,l[5],Ke),s=t||ol();return{c(){s&&s.c()},l(o){s&&s.l(o)},m(o,i){s&&s.m(o,i),e=!0},p(o,i){t&&t.p&&(!e||i&807)&&ke(t,n,o,o[5],e?Ce(n,o[5],i,nl):we(o[5]),Ke)},i(o){e||(M(s,o),e=!0)},o(o){y(s,o),e=!1},d(o){s&&s.d(o)}}}function rl(l){let e=l[6],n,t,s=Xe(l);return{c(){s.c(),n=A()},l(o){s.l(o),n=S(o)},m(o,i){s.m(o,i),q(o,n,i),t=!0},p(o,i){i&5&&fe(e,e=o[6])?(de(),y(s,1,1,J),pe(),s=Xe(o),s.c(),M(s,1),s.m(n.parentNode,n)):s.p(o,i)},i(o){t||(M(s),t=!0)},o(o){y(s),t=!1},d(o){o&&g(n),s.d(o)}}}function We(l){var c,d;let e,n,t;const s=l[3].default,o=be(s,l,l[5],Je),i=o||il();let f=((d=(c=l[6])==null?void 0:c.children)==null?void 0:d.length)>0&&Qe(l);return{c(){i&&i.c(),e=A(),f&&f.c(),n=ue()},l(a){i&&i.l(a),e=S(a),f&&f.l(a),n=ue()},m(a,r){i&&i.m(a,r),q(a,e,r),f&&f.m(a,r),q(a,n,r),t=!0},p(a,r){var u,p;o&&o.p&&(!t||r&39)&&ke(o,s,a,a[5],t?Ce(s,a[5],r,sl):we(a[5]),Je),((p=(u=a[6])==null?void 0:u.children)==null?void 0:p.length)>0?f?(f.p(a,r),r&5&&M(f,1)):(f=Qe(a),f.c(),M(f,1),f.m(n.parentNode,n)):f&&(de(),y(f,1,1,()=>{f=null}),pe())},i(a){t||(M(i,a),M(f),t=!0)},o(a){y(i,a),y(f),t=!1},d(a){a&&(g(e),g(n)),i&&i.d(a),f&&f.d(a)}}}function al(l){let e,n,t=je(l[0].map(l[4])),s=[];for(let i=0;i<t.length;i+=1)s[i]=We(Ge(l,t,i));const o=i=>y(s[i],1,1,()=>{s[i]=null});return{c(){e=C("section");for(let i=0;i<s.length;i+=1)s[i].c();this.h()},l(i){e=$(i,"SECTION",{style:!0});var f=j(e);for(let c=0;c<s.length;c+=1)s[c].l(f);f.forEach(g),this.h()},h(){Y(e,"--level",l[1])},m(i,f){q(i,e,f);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(e,null);n=!0},p(i,[f]){if(f&807){t=je(i[0].map(i[4]));let c;for(c=0;c<t.length;c+=1){const d=Ge(i,t,c);s[c]?(s[c].p(d,f),M(s[c],1)):(s[c]=We(d),s[c].c(),M(s[c],1),s[c].m(e,null))}for(de(),c=t.length;c<s.length;c+=1)o(c);pe()}(!n||f&2)&&Y(e,"--level",i[1])},i(i){if(!n){for(let f=0;f<t.length;f+=1)M(s[f]);n=!0}},o(i){s=s.filter(Boolean);for(let f=0;f<s.length;f+=1)y(s[f]);n=!1},d(i){i&&g(e),pt(s,i)}}}function cl(l,e,n){let t;oe(l,G,d=>n(2,t=d));let{$$slots:s={},$$scope:o}=e,{capabilities:i=[]}=e,{level:f=0}=e;const c=d=>t.measures[d.toLowerCase()];return l.$$set=d=>{"capabilities"in d&&n(0,i=d.capabilities),"level"in d&&n(1,f=d.level),"$$scope"in d&&n(5,o=d.$$scope)},[i,f,t,s,c,o]}class ht extends me{constructor(e){super(),he(this,e,cl,al,fe,{capabilities:0,level:1})}}function ul(l){let e,n,t,s,o,i,f,c=l[36].name+"",d,a,r=l[0][l[36].name.toLowerCase()],u,p,h;function O(...E){return l[27](l[36],l[7],...E)}let _=r&&Ye(l);function D(...E){return l[29](l[36],l[37],...E)}function w(...E){return l[30](l[36],...E)}return{c(){e=C("article"),n=C("div"),t=C("div"),s=C("input"),i=A(),f=C("span"),d=ae(c),a=A(),_&&_.c(),this.h()},l(E){e=$(E,"ARTICLE",{class:!0});var N=j(e);n=$(N,"DIV",{class:!0,tabindex:!0,role:!0});var v=j(n);t=$(v,"DIV",{class:!0});var I=j(t);s=$(I,"INPUT",{class:!0,type:!0,name:!0,style:!0}),i=S(I),f=$(I,"SPAN",{class:!0});var Z=j(f);d=ce(Z,c),Z.forEach(g),I.forEach(g),a=S(v),_&&_.l(v),v.forEach(g),N.forEach(g),this.h()},h(){var E;m(s,"class","check-box svelte-1yjwnw9"),m(s,"type","checkbox"),m(s,"name","include"),s.checked=o=(E=l[36])==null?void 0:E.checked,Y(s,"accent-color",l[7].color),m(f,"class","measure-text svelte-1yjwnw9"),m(t,"class","child-row svelte-1yjwnw9"),m(n,"class","measure-child measure-hover svelte-1yjwnw9"),m(n,"tabindex","0"),m(n,"role","button"),x(n,"selected-measure",l[0][l[36].name.toLowerCase()]),m(e,"class","container-measure-child svelte-1yjwnw9")},m(E,N){q(E,e,N),b(e,n),b(n,t),b(t,s),b(t,i),b(t,f),b(f,d),b(n,a),_&&_.m(n,null),u=!0,p||(h=[Q(s,"click",ye(O)),Q(n,"click",D),Q(n,"keydown",w)],p=!0)},p(E,N){var v;l=E,(!u||N[1]&32&&o!==(o=(v=l[36])==null?void 0:v.checked))&&(s.checked=o),(!u||N[0]&128)&&Y(s,"accent-color",l[7].color),(!u||N[1]&32)&&c!==(c=l[36].name+"")&&ve(d,c),N[0]&1|N[1]&32&&(r=l[0][l[36].name.toLowerCase()]),r?_?(_.p(l,N),N[0]&1|N[1]&32&&M(_,1)):(_=Ye(l),_.c(),M(_,1),_.m(n,null)):_&&(de(),y(_,1,1,()=>{_=null}),pe()),(!u||N[0]&1|N[1]&32)&&x(n,"selected-measure",l[0][l[36].name.toLowerCase()])},i(E){u||(M(_),u=!0)},o(E){y(_),u=!1},d(E){E&&g(e),_&&_.d(),p=!1,ge(h)}}}function fl(l){var E;let e,n,t,s,o,i,f=l[36].name+"",c,d,a=l[0][l[36].name.toLowerCase()]||((E=l[36].children)==null?void 0:E.some(l[18])),r,u,p,h;function O(...N){return l[19](l[36],...N)}let _=a&&xe(l);function D(...N){return l[25](l[36],...N)}function w(...N){return l[26](l[36],...N)}return{c(){e=C("div"),n=C("form"),t=C("input"),o=A(),i=C("span"),c=ae(f),d=A(),_&&_.c(),this.h()},l(N){e=$(N,"DIV",{class:!0,tabindex:!0,role:!0,title:!0});var v=j(e);n=$(v,"FORM",{});var I=j(n);t=$(I,"INPUT",{class:!0,type:!0,name:!0,tabindex:!0,style:!0}),I.forEach(g),o=S(v),i=$(v,"SPAN",{class:!0});var Z=j(i);c=ce(Z,f),Z.forEach(g),d=S(v),_&&_.l(v),v.forEach(g),this.h()},h(){var N,v,I,Z;m(t,"class","check-box svelte-1yjwnw9"),m(t,"type","checkbox"),m(t,"name","include"),t.checked=s=(N=l[36])==null?void 0:N.checked,m(t,"tabindex","0"),Y(t,"accent-color",l[36].color),m(i,"class","measure-text svelte-1yjwnw9"),x(i,"parent-measure",((v=l[36].children)==null?void 0:v.length)>0),m(e,"class","measure-parent svelte-1yjwnw9"),m(e,"tabindex","0"),m(e,"role","button"),m(e,"title",r=`Definition: 

`+l[36].description),x(e,"selected-measure",l[0][l[36].name.toLowerCase()]),x(e,"measure-hover",!((Z=(I=l[36])==null?void 0:I.children)!=null&&Z.length))},m(N,v){q(N,e,v),b(e,n),b(n,t),b(e,o),b(e,i),b(i,c),b(e,d),_&&_.m(e,null),u=!0,p||(h=[Q(t,"click",ye(O)),Q(e,"click",D),Q(e,"keydown",w)],p=!0)},p(N,v){var I,Z,R,X,T;l=N,(!u||v[1]&32&&s!==(s=(I=l[36])==null?void 0:I.checked))&&(t.checked=s),(!u||v[1]&32)&&Y(t,"accent-color",l[36].color),(!u||v[1]&32)&&f!==(f=l[36].name+"")&&ve(c,f),(!u||v[1]&32)&&x(i,"parent-measure",((Z=l[36].children)==null?void 0:Z.length)>0),v[0]&1|v[1]&32&&(a=l[0][l[36].name.toLowerCase()]||((R=l[36].children)==null?void 0:R.some(l[18]))),a?_?(_.p(l,v),v[0]&1|v[1]&32&&M(_,1)):(_=xe(l),_.c(),M(_,1),_.m(e,null)):_&&(de(),y(_,1,1,()=>{_=null}),pe()),(!u||v[1]&32&&r!==(r=`Definition: 

`+l[36].description))&&m(e,"title",r),(!u||v[0]&1|v[1]&32)&&x(e,"selected-measure",l[0][l[36].name.toLowerCase()]),(!u||v[1]&32)&&x(e,"measure-hover",!((T=(X=l[36])==null?void 0:X.children)!=null&&T.length))},i(N){u||(M(_),u=!0)},o(N){y(_),u=!1},d(N){N&&g(e),_&&_.d(),p=!1,ge(h)}}}function Ye(l){let e,n,t,s;function o(...i){return l[28](l[7],l[36],...i)}return n=new re({props:{size:28,iconName:"delete",description:"Delete Capability"}}),n.$on("iconClick",o),{c(){e=C("div"),z(n.$$.fragment),this.h()},l(i){e=$(i,"DIV",{class:!0});var f=j(e);H(n.$$.fragment,f),f.forEach(g),this.h()},h(){m(e,"class","measure-btns svelte-1yjwnw9")},m(i,f){q(i,e,f),U(n,e,null),s=!0},p(i,f){l=i},i(i){s||(M(n.$$.fragment,i),i&&Me(()=>{s&&(t||(t=ie(e,Oe,{axis:"x",duration:200,x:10},!0)),t.run(1))}),s=!0)},o(i){y(n.$$.fragment,i),i&&(t||(t=ie(e,Oe,{axis:"x",duration:200,x:10},!1)),t.run(0)),s=!1},d(i){i&&g(e),B(n),i&&t&&t.end()}}}function xe(l){let e,n,t,s,o,i,f;function c(...r){return l[20](l[36],...r)}n=new re({props:{size:30,iconName:"plus",description:"Create Capability Child"}}),n.$on("iconClick",c);function d(...r){return l[21](l[36],...r)}s=new re({props:{size:30,iconName:"delete",description:"Delete Capability and Children"}}),s.$on("iconClick",d);let a=l[1].techniqueMappingMode==="multiColor"&&et(l);return{c(){e=C("div"),z(n.$$.fragment),t=A(),z(s.$$.fragment),o=A(),a&&a.c(),this.h()},l(r){e=$(r,"DIV",{class:!0});var u=j(e);H(n.$$.fragment,u),t=S(u),H(s.$$.fragment,u),o=S(u),a&&a.l(u),u.forEach(g),this.h()},h(){m(e,"class","measure-btns svelte-1yjwnw9")},m(r,u){q(r,e,u),U(n,e,null),b(e,t),U(s,e,null),b(e,o),a&&a.m(e,null),f=!0},p(r,u){l=r,l[1].techniqueMappingMode==="multiColor"?a?(a.p(l,u),u[0]&2&&M(a,1)):(a=et(l),a.c(),M(a,1),a.m(e,null)):a&&(de(),y(a,1,1,()=>{a=null}),pe())},i(r){f||(M(n.$$.fragment,r),M(s.$$.fragment,r),M(a),Me(()=>{f&&(i||(i=ie(e,Oe,{axis:"x",duration:100,x:10},!0)),i.run(1))}),f=!0)},o(r){y(n.$$.fragment,r),y(s.$$.fragment,r),y(a),i||(i=ie(e,Oe,{axis:"x",duration:100,x:10},!1)),i.run(0),f=!1},d(r){r&&g(e),B(n),B(s),a&&a.d(),r&&i&&i.end()}}}function et(l){let e,n,t,s,o=l[37],i,f,c;function d(...p){return l[22](l[36],l[37],...p)}e=new re({props:{size:30,iconName:"color picker",description:"Pick Capability Family Color"}}),e.$on("iconClick",d);const a=()=>l[23](t,o),r=()=>l[23](null,o);function u(...p){return l[24](l[36],l[37],...p)}return{c(){z(e.$$.fragment),n=A(),t=C("input"),this.h()},l(p){H(e.$$.fragment,p),n=S(p),t=$(p,"INPUT",{type:!0,id:!0,name:!0,style:!0}),this.h()},h(){m(t,"type","color"),m(t,"id","head"),m(t,"name","head"),t.value=s=l[36].color,Y(t,"display","none")},m(p,h){U(e,p,h),q(p,n,h),q(p,t,h),a(),i=!0,f||(c=Q(t,"input",u),f=!0)},p(p,h){l=p,(!i||h[1]&32&&s!==(s=l[36].color))&&(t.value=s),o!==l[37]&&(r(),o=l[37],a())},i(p){i||(M(e.$$.fragment,p),i=!0)},o(p){y(e.$$.fragment,p),i=!1},d(p){p&&(g(n),g(t)),B(e,p),r(),f=!1,c()}}}function dl(l){let e,n,t,s;const o=[fl,ul],i=[];function f(c,d){return c[38]===0?0:c[38]===1?1:-1}return~(e=f(l))&&(n=i[e]=o[e](l)),{c(){n&&n.c(),t=ue()},l(c){n&&n.l(c),t=ue()},m(c,d){~e&&i[e].m(c,d),q(c,t,d),s=!0},p(c,d){let a=e;e=f(c),e===a?~e&&i[e].p(c,d):(n&&(de(),y(i[a],1,1,()=>{i[a]=null}),pe()),~e?(n=i[e],n?n.p(c,d):(n=i[e]=o[e](c),n.c()),M(n,1),n.m(t.parentNode,t)):n=null)},i(c){s||(M(n),s=!0)},o(c){y(n),s=!1},d(c){c&&g(t),~e&&i[e].d(c)}}}function pl(l){var N;let e,n,t,s,o,i,f,c,d,a,r,u,p,h,O,_,D,w,E;return t=new ll({}),i=new ht({props:{capabilities:((N=l[5])==null?void 0:N.includedMeasures)||[],$$slots:{default:[dl,({capability:v,idx:I,level:Z,parent:R})=>({36:v,37:I,38:Z,7:R}),({capability:v,idx:I,level:Z,parent:R})=>[R?128:0,(v?32:0)|(I?64:0)|(Z?128:0)]]},$$scope:{ctx:l}}}),h=new Se({props:{dialog:l[2],parent:l[7],title:"Create child capability of:"}}),h.$on("dispatch",l[32]),{c(){e=C("main"),n=C("section"),z(t.$$.fragment),s=A(),o=C("section"),z(i.$$.fragment),f=A(),c=C("section"),d=C("div"),a=C("button"),r=ae("Save Techniques"),u=A(),p=C("dialog"),z(h.$$.fragment),this.h()},l(v){e=$(v,"MAIN",{class:!0});var I=j(e);n=$(I,"SECTION",{id:!0,class:!0});var Z=j(n);H(t.$$.fragment,Z),Z.forEach(g),s=S(I),o=$(I,"SECTION",{id:!0,class:!0});var R=j(o);H(i.$$.fragment,R),R.forEach(g),f=S(I),c=$(I,"SECTION",{id:!0,class:!0});var X=j(c);d=$(X,"DIV",{id:!0,class:!0});var T=j(d);a=$(T,"BUTTON",{class:!0,type:!0});var k=j(a);r=ce(k,"Save Techniques"),k.forEach(g),T.forEach(g),X.forEach(g),u=S(I),p=$(I,"DIALOG",{});var V=j(p);H(h.$$.fragment,V),V.forEach(g),I.forEach(g),this.h()},h(){m(n,"id","container-header"),m(n,"class","svelte-1yjwnw9"),m(o,"id","container-measure"),m(o,"class","svelte-1yjwnw9"),m(a,"class","control-btn svelte-1yjwnw9"),m(a,"type","button"),a.disabled=l[4],m(d,"id","row-persist-btns"),m(d,"class","svelte-1yjwnw9"),m(c,"id","container-btns"),m(c,"class","svelte-1yjwnw9"),m(e,"class","svelte-1yjwnw9")},m(v,I){q(v,e,I),b(e,n),U(t,n,null),b(e,s),b(e,o),U(i,o,null),b(e,f),b(e,c),b(c,d),b(d,a),b(a,r),b(e,u),b(e,p),U(h,p,null),l[33](p),D=!0,w||(E=Q(a,"click",l[31]),w=!0)},p(v,I){var X;const Z={};I[0]&32&&(Z.capabilities=((X=v[5])==null?void 0:X.includedMeasures)||[]),I[0]&139|I[1]&480&&(Z.$$scope={dirty:I,ctx:v}),i.$set(Z),(!D||I[0]&16)&&(a.disabled=v[4]);const R={};I[0]&4&&(R.dialog=v[2]),I[0]&128&&(R.parent=v[7]),h.$set(R)},i(v){D||(M(t.$$.fragment,v),M(i.$$.fragment,v),M(h.$$.fragment,v),v&&Me(()=>{D&&(_&&_.end(1),O=Et(e,$e,{delay:400}),O.start())}),D=!0)},o(v){y(t.$$.fragment,v),y(i.$$.fragment,v),y(h.$$.fragment,v),O&&O.invalidate(),v&&(_=Nt(e,$e,{duration:100})),D=!1},d(v){v&&g(e),B(t),B(i),B(h),l[33](null),v&&_&&_.end(),w=!1,E()}}}function ml(l,e,n){let t,s,o;oe(l,G,L=>n(1,s=L)),oe(l,se,L=>n(6,o=L));let i,f,c=[],d=!0,a={};const r=(L,P)=>{var Ee;if(s.isReadonly||(Ee=P==null?void 0:P.children)!=null&&Ee.length)return;const F=P.name.toLowerCase();if(L.shiftKey)n(0,a[F]=!a[F],a);else{const Te=a[F];Object.entries(a).forEach(([Pe])=>{n(0,a[Pe]=!1,a)}),n(0,a[F]=!Te,a)}},u=(L,P,F)=>{L.code==="Enter"&&P(L,F)},p=(L,P,F)=>{var Te;const Ee=(Te=s.measures[P.name.toLowerCase()])==null?void 0:Te.checked;te(G,s.measures[P.name.toLowerCase()].checked=!Ee,s),P.children&&P.children.forEach(Pe=>{te(G,s.measures[Pe.toLowerCase()].checked=!Ee,s)})},h=L=>{n(7,f=L),i.showModal()},O=L=>{const{parent:P,dialogSubmitObject:F}=L.detail;G.addChild(P,F)},_=(L,P)=>{G.deleteMeasure(P)},D=(L,P,F)=>{G.deleteSubmeasure(P,F)},w=(L,P,F)=>{G.saveTechniques(P,F),se.reset()},E=(L,P,F)=>{F.click()},N=(L,P)=>{G.saveMeasureColor(P,L.srcElement.value)},v=L=>a[L],I=(L,P)=>p(P,L),Z=(L,P)=>h(L),R=(L,P)=>_(P,L),X=(L,P,F)=>E(F,L,c[P]);function T(L,P){_e[L?"unshift":"push"](()=>{c[P]=L,n(3,c)})}const k=(L,P,F)=>N(F,L,c[P]),V=(L,P)=>r(P,L),W=(L,P)=>u(P,r,L),K=(L,P,F)=>p(F,L),ee=(L,P,F)=>D(F,L,P),ne=(L,P,F)=>r(F,L),Ne=(L,P)=>u(P,r,L),Ie=L=>w(L,o.treeMap,a),_t=L=>O(L);function gt(L){_e[L?"unshift":"push"](()=>{i=L,n(2,i)})}return l.$$.update=()=>{var L;l.$$.dirty[0]&2&&n(5,t=(L=s==null?void 0:s.portfolios)==null?void 0:L[s==null?void 0:s.selectedPortfolio]),l.$$.dirty[0]&1&&n(4,d=!Object.values(a).some(P=>P))},[a,s,i,c,d,t,o,f,r,u,p,h,O,_,D,w,E,N,v,I,Z,R,X,T,k,V,W,K,ee,ne,Ne,Ie,_t,gt]}class hl extends me{constructor(e){super(),he(this,e,ml,pl,fe,{},null,[-1,-1])}}const _l=l=>({}),tt=l=>({}),gl=l=>({}),lt=l=>({id:"matrix-slot"}),vl=l=>({}),nt=l=>({});function st(l){let e,n,t;const s=l[2].drawer,o=be(s,l,l[1],nt);return{c(){e=C("aside"),o&&o.c(),this.h()},l(i){e=$(i,"ASIDE",{id:!0,class:!0});var f=j(e);o&&o.l(f),f.forEach(g),this.h()},h(){m(e,"id","container-drawer"),m(e,"class","svelte-1u5pphb"),x(e,"drawer-closed",!l[0].isDrawerOpen)},m(i,f){q(i,e,f),o&&o.m(e,null),t=!0},p(i,f){l=i,o&&o.p&&(!t||f&2)&&ke(o,s,l,l[1],t?Ce(s,l[1],f,vl):we(l[1]),nt),(!t||f&1)&&x(e,"drawer-closed",!l[0].isDrawerOpen)},i(i){t||(M(o,i),i&&Me(()=>{t&&(n||(n=ie(e,Fe,{axis:"x",duration:Ve},!0)),n.run(1))}),t=!0)},o(i){y(o,i),i&&(n||(n=ie(e,Fe,{axis:"x",duration:Ve},!1)),n.run(0)),t=!1},d(i){i&&g(e),o&&o.d(i),i&&n&&n.end()}}}function bl(l){let e,n,t,s,o,i=l[0].isDrawerOpen&&st(l);const f=l[2].matrix,c=be(f,l,l[1],lt),d=l[2].legend,a=be(d,l,l[1],tt);return{c(){e=C("main"),i&&i.c(),n=A(),t=C("section"),c&&c.c(),s=A(),a&&a.c(),this.h()},l(r){e=$(r,"MAIN",{style:!0,class:!0});var u=j(e);i&&i.l(u),n=S(u),t=$(u,"SECTION",{id:!0,class:!0});var p=j(t);c&&c.l(p),s=S(p),a&&a.l(p),p.forEach(g),u.forEach(g),this.h()},h(){m(t,"id","container-matrix"),m(t,"class","svelte-1u5pphb"),x(t,"expand-matrix",l[0].isDrawerOpen),Y(e,"--drawer-width",kl),Y(e,"--ANIMATION_TIMING",Ve),m(e,"class","svelte-1u5pphb")},m(r,u){q(r,e,u),i&&i.m(e,null),b(e,n),b(e,t),c&&c.m(t,null),b(t,s),a&&a.m(t,null),o=!0},p(r,[u]){r[0].isDrawerOpen?i?(i.p(r,u),u&1&&M(i,1)):(i=st(r),i.c(),M(i,1),i.m(e,n)):i&&(de(),y(i,1,1,()=>{i=null}),pe()),c&&c.p&&(!o||u&2)&&ke(c,f,r,r[1],o?Ce(f,r[1],u,gl):we(r[1]),lt),a&&a.p&&(!o||u&2)&&ke(a,d,r,r[1],o?Ce(d,r[1],u,_l):we(r[1]),tt),(!o||u&1)&&x(t,"expand-matrix",r[0].isDrawerOpen)},i(r){o||(M(i),M(c,r),M(a,r),o=!0)},o(r){y(i),y(c,r),y(a,r),o=!1},d(r){r&&g(e),i&&i.d(),c&&c.d(r),a&&a.d(r)}}}const Ve=1e3;let kl="25vw";function wl(l,e,n){let t;oe(l,G,i=>n(0,t=i));let{$$slots:s={},$$scope:o}=e;return l.$$set=i=>{"$$scope"in i&&n(1,o=i.$$scope)},[t,o,s]}class Cl extends me{constructor(e){super(),he(this,e,wl,bl,fe,{})}}function it(l,e,n){const t=l.slice();return t[5]=e[n],t}function ot(l){let e,n=je(l[1].map(l[4]).reverse()),t=[];for(let s=0;s<n.length;s+=1)t[s]=at(it(l,n,s));return{c(){e=C("div");for(let s=0;s<t.length;s+=1)t[s].c();this.h()},l(s){e=$(s,"DIV",{id:!0,class:!0});var o=j(e);for(let i=0;i<t.length;i+=1)t[i].l(o);o.forEach(g),this.h()},h(){m(e,"id","legend"),m(e,"class","svelte-j56lk0")},m(s,o){q(s,e,o);for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(e,null)},p(s,o){if(o&3){n=je(s[1].map(s[4]).reverse());let i;for(i=0;i<n.length;i+=1){const f=it(s,n,i);t[i]?t[i].p(f,o):(t[i]=at(f),t[i].c(),t[i].m(e,null))}for(;i<t.length;i+=1)t[i].d(1);t.length=n.length}},d(s){s&&g(e),pt(t,s)}}}function rt(l){let e,n=l[5].name+"",t,s;return{c(){e=C("div"),t=ae(n),s=A(),this.h()},l(o){e=$(o,"DIV",{class:!0,style:!0});var i=j(e);t=ce(i,n),s=S(i),i.forEach(g),this.h()},h(){m(e,"class","legend-item svelte-j56lk0"),Y(e,"background",l[5].color)},m(o,i){q(o,e,i),b(e,t),b(e,s)},p(o,i){i&3&&n!==(n=o[5].name+"")&&ve(t,n),i&3&&Y(e,"background",o[5].color)},d(o){o&&g(e)}}}function at(l){let e,n=l[5].checked&&rt(l);return{c(){n&&n.c(),e=ue()},l(t){n&&n.l(t),e=ue()},m(t,s){n&&n.m(t,s),q(t,e,s)},p(t,s){t[5].checked?n?n.p(t,s):(n=rt(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d(t){t&&g(e),n&&n.d(t)}}}function ct(l){let e,n,t="Drawer",s,o,i="Select None",f,c;return{c(){e=C("div"),n=C("button"),n.textContent=t,s=A(),o=C("button"),o.textContent=i,this.h()},l(d){e=$(d,"DIV",{id:!0});var a=j(e);n=$(a,"BUTTON",{class:!0,"data-svelte-h":!0}),le(n)!=="svelte-1d0ebnl"&&(n.textContent=t),s=S(a),o=$(a,"BUTTON",{class:!0,"data-svelte-h":!0}),le(o)!=="svelte-dxj0z0"&&(o.textContent=i),a.forEach(g),this.h()},h(){m(n,"class","svelte-j56lk0"),m(o,"class","svelte-j56lk0"),m(e,"id","matrix-btns")},m(d,a){q(d,e,a),b(e,n),b(e,s),b(e,o),f||(c=[Q(n,"click",l[2]),Q(o,"click",l[3])],f=!0)},p:J,d(d){d&&g(e),f=!1,ge(c)}}}function $l(l){let e,n,t=l[0].showLegend&&l[0].techniqueMappingMode!=="heatMap"&&l[1]&&ot(l),s=!l[0].isReadonly&&ct(l);return{c(){e=C("div"),t&&t.c(),n=A(),s&&s.c(),this.h()},l(o){e=$(o,"DIV",{id:!0,class:!0});var i=j(e);t&&t.l(i),n=S(i),s&&s.l(i),i.forEach(g),this.h()},h(){m(e,"id","container-legend"),m(e,"class","svelte-j56lk0")},m(o,i){q(o,e,i),t&&t.m(e,null),b(e,n),s&&s.m(e,null)},p(o,[i]){o[0].showLegend&&o[0].techniqueMappingMode!=="heatMap"&&o[1]?t?t.p(o,i):(t=ot(o),t.c(),t.m(e,n)):t&&(t.d(1),t=null),o[0].isReadonly?s&&(s.d(1),s=null):s?s.p(o,i):(s=ct(o),s.c(),s.m(e,null))},i:J,o:J,d(o){o&&g(e),t&&t.d(),s&&s.d()}}}function Ml(l,e,n){let t,s;oe(l,G,c=>n(0,s=c));const o=()=>{te(G,s.isDrawerOpen=!s.isDrawerOpen,s)},i=()=>{se.reset("test")},f=c=>s.measures[c.toLowerCase()];return l.$$.update=()=>{var c,d;l.$$.dirty&1&&n(1,t=(d=(c=s==null?void 0:s.portfolios)==null?void 0:c[s==null?void 0:s.selectedPortfolio])==null?void 0:d.includedMeasures)},[s,t,o,i,f]}class El extends me{constructor(e){super(),he(this,e,Ml,$l,fe,{})}}const{window:Nl}=$t;function Il(l){let e,n;return e=new hl({props:{slot:"drawer"}}),{c(){z(e.$$.fragment)},l(t){H(e.$$.fragment,t)},m(t,s){U(e,t,s),n=!0},p:J,i(t){n||(M(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function Tl(l){let e,n;return e=new jt({props:{treeStore:l[2],theme:"main",slot:"matrix"}}),e.$on("elementClick",l[5]),{c(){z(e.$$.fragment)},l(t){H(e.$$.fragment,t)},m(t,s){U(e,t,s),n=!0},p(t,s){const o={};s&4&&(o.treeStore=t[2]),e.$set(o)},i(t){n||(M(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function Dl(l){let e,n;return e=new El({props:{slot:"legend"}}),{c(){z(e.$$.fragment)},l(t){H(e.$$.fragment,t)},m(t,s){U(e,t,s),n=!0},p:J,i(t){n||(M(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){B(e,t)}}}function Ll(l){return{c:J,l:J,m:J,p:J,i:J,o:J,d:J}}function yl(l){let e,n,t=l[3]&&ut(l);return{c(){t&&t.c(),e=ue()},l(s){t&&t.l(s),e=ue()},m(s,o){t&&t.m(s,o),q(s,e,o),n=!0},p(s,o){s[3]?t?(t.p(s,o),o&8&&M(t,1)):(t=ut(s),t.c(),M(t,1),t.m(e.parentNode,e)):t&&(de(),y(t,1,1,()=>{t=null}),pe())},i(s){n||(M(t),n=!0)},o(s){y(t),n=!1},d(s){s&&g(e),t&&t.d(s)}}}function ut(l){let e,n="esc",t,s,o,i,f;return s=new qt({props:{technique_id:l[0].technique_id,technique:l[15]}}),{c(){e=C("button"),e.textContent=n,t=A(),z(s.$$.fragment)},l(c){e=$(c,"BUTTON",{"data-svelte-h":!0}),le(e)!=="svelte-10d8xzb"&&(e.textContent=n),t=S(c),H(s.$$.fragment,c)},m(c,d){q(c,e,d),q(c,t,d),U(s,c,d),o=!0,i||(f=Q(e,"click",dt(l[9])),i=!0)},p(c,d){const a={};d&1&&(a.technique_id=c[0].technique_id),d&8&&(a.technique=c[15]),s.$set(a)},i(c){o||(M(s.$$.fragment,c),o=!0)},o(c){y(s.$$.fragment,c),o=!1},d(c){c&&(g(e),g(t)),B(s,c),i=!1,f()}}}function Ol(l){let e,n="loading...";return{c(){e=C("span"),e.textContent=n},l(t){e=$(t,"SPAN",{"data-svelte-h":!0}),le(e)!=="svelte-sermp4"&&(e.textContent=n)},m(t,s){q(t,e,s)},p:J,i:J,o:J,d(t){t&&g(e)}}}function jl(l){let e,n,t,s,o,i,f,c,d,a;e=new Pt({props:{title:"Embedded D3FEND Matrix",og_title:"MITRE Embedded D3FEND Measures",og_type:"website",og_url:"https://d3fend.mitre.org/",og_image:"https://d3fend.mitre.org/img/d3fend-og.png",og_description:"D3FEND Measures Analysis."}}),s=new Cl({props:{$$slots:{legend:[Dl],matrix:[Tl],drawer:[Il]},$$scope:{ctx:l}}});let r={ctx:l,current:null,token:null,hasCatch:!1,pending:Ol,then:yl,catch:Ll,value:15,blocks:[,,,]};return Ze(f=l[3],r),{c(){z(e.$$.fragment),n=A(),t=C("main"),z(s.$$.fragment),o=A(),i=C("dialog"),r.block.c(),this.h()},l(u){H(e.$$.fragment,u),n=S(u),t=$(u,"MAIN",{});var p=j(t);H(s.$$.fragment,p),o=S(p),i=$(p,"DIALOG",{class:!0});var h=j(i);r.block.l(h),h.forEach(g),p.forEach(g),this.h()},h(){m(i,"class","technique-dialog")},m(u,p){U(e,u,p),q(u,n,p),q(u,t,p),U(s,t,null),b(t,o),b(t,i),r.block.m(i,r.anchor=null),r.mount=()=>i,r.anchor=null,l[10](i),c=!0,d||(a=[Q(Nl,"message",l[4]),Q(i,"close",l[11])],d=!0)},p(u,[p]){l=u;const h={};p&65540&&(h.$$scope={dirty:p,ctx:l}),s.$set(h),r.ctx=l,p&8&&f!==(f=l[3])&&Ze(f,r)||wt(r,l,p)},i(u){c||(M(e.$$.fragment,u),M(s.$$.fragment,u),M(r.block),c=!0)},o(u){y(e.$$.fragment,u),y(s.$$.fragment,u);for(let p=0;p<3;p+=1){const h=r.blocks[p];y(h)}c=!1},d(u){u&&(g(n),g(t)),B(e,u),B(s),r.block.d(),r.token=null,r=null,l[10](null),d=!1,ge(a)}}}function Pl(l,e,n){let t,s,o;oe(l,se,w=>n(12,t=w)),oe(l,G,w=>n(13,s=w)),oe(l,It,w=>n(8,o=w));let{data:i}=e,f,c=null,d,a;kt(()=>{if(n(2,f=Vt(G,se)),window.parent.postMessage({call:"FromParent",value:s},"*"),n(7,d=document.getElementsByTagName("body")[0]),o.url.searchParams.size){const w=o.url.search.split("=").at(-1);n(3,c=h(w)),qe(`/profile?technique_id=${w}`)}}),Tt(()=>{d==null||d.classList.remove("scroll--none")});const r=w=>{te(G,s=w.data.value,s)},u=w=>{const E=w.detail.element["@id"];if(!w.detail.event.ctrlKey&&!w.detail.event.metaKey){const N=w.detail.element["@id"];n(3,c=h(N)),qe(`/profile?technique_id=${N}`);return}t.treeMap[E].classes.isSelected?(te(se,t.treeMap[E].classes.select="",t),te(se,t.treeMap[E].classes.isSelected=!1,t)):(te(se,t.treeMap[E].classes.select="3px solid red",t),te(se,t.treeMap[E].classes.isSelected=!0,t))},p=w=>{a.close(),qe("/profile")},h=async w=>{const E=await fetch(`/api/technique/${w}.json`),N=await E.json();if(E.ok)return N;throw new Error(N)},O=w=>p();function _(w){_e[w?"unshift":"push"](()=>{a=w,n(1,a)})}const D=w=>p();return l.$$set=w=>{"data"in w&&n(0,i=w.data)},l.$$.update=()=>{l.$$.dirty&386&&(a&&o.url.searchParams.size?(a.showModal(),d==null||d.classList.add("scroll--none")):a&&(a.close(),d==null||d.classList.remove("scroll--none")))},[i,a,f,c,r,u,p,d,o,O,_,D]}class Xl extends me{constructor(e){super(),he(this,e,Pl,jl,fe,{data:0})}}export{Xl as component};
