import{s as fe,f as E,M as De,l as ae,g as N,h as O,N as Le,m as ce,d as h,j as m,E as x,k as Y,i as P,x as b,C as Q,n as ve,y as J,a7 as ft,a as A,c as S,F as le,a6 as dt,D as ge,z as oe,p as he,r as be,e as ue,u as ke,v as we,w as Ce,ak as ye,H as Me,a8 as vt,A as bt,B as te,G as pt,o as kt}from"../chunks/scheduler.3032ca4b.js";import{h as Ze,u as wt}from"../chunks/await_block.99b27d44.js";import{S as Ct,g as $t}from"../chunks/SimpleAutocomplete.60cf9111.js";import{S as me,i as _e,a as I,g as de,t as y,c as pe,p as ie,f as Mt,b as H,d as U,m as B,e as R,h as Et,j as Nt}from"../chunks/index.ee8739bf.js";import{p as It}from"../chunks/stores.d382b45a.js";import{b as Tt,g as qe}from"../chunks/navigation.f9314e12.js";import{a as $e,f as Oe,s as Fe}from"../chunks/index.4dcc05a9.js";import{d as Dt,w as Lt}from"../chunks/index.e2937cfb.js";import{f as yt}from"../chunks/consts.61ebf608.js";import{T as Ot,a as se}from"../chunks/updateDefendTree.85968da5.js";/* empty css                             */import{e as je}from"../chunks/each.6507e059.js";import{D as jt}from"../chunks/D3FMatrix.51a4c0a0.js";import{T as Pt}from"../chunks/Title.8f901ed1.js";import{T as qt}from"../chunks/Technique.93e0395c.js";const ze={setting:"M19.5 12c0 .34-.03.66-.07.98l2.11 1.65c.19.15.24.42.12.64l-2 3.46c-.12.22-.38.31-.61.22l-2.49-1c-.52.39-1.08.73-1.69.98l-.38 2.65c-.03.24-.24.42-.49.42h-4c-.25 0-.46-.18-.49-.42l-.38-2.65c-.61-.25-1.17-.58-1.69-.98l-2.49 1c-.22.08-.49 0-.61-.22l-2-3.46a.505.505 0 0 1 .12-.64l2.11-1.65A7.93 7.93 0 0 1 4.5 12c0-.33.03-.66.07-.98L2.46 9.37a.493.493 0 0 1-.12-.64l2-3.46c.12-.22.38-.31.61-.22l2.49 1c.52-.39 1.08-.73 1.69-.98l.38-2.65c.03-.24.24-.42.49-.42h4c.25 0 .46.18.49.42l.38 2.65c.61.25 1.17.58 1.69.98l2.49-1c.22-.08.49 0 .61.22l2 3.46c.12.22.07.49-.12.64l-2.11 1.65c.04.32.07.64.07.98Zm-11 0c0 1.93 1.57 3.5 3.5 3.5s3.5-1.57 3.5-3.5-1.57-3.5-3.5-3.5-3.5 1.57-3.5 3.5Z","color picker":"M12 3a9 9 0 0 0 0 18c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8Zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12ZM8 6.5C8 7.33 8.67 8 9.5 8S11 7.33 11 6.5 10.33 5 9.5 5 8 5.67 8 6.5ZM14.5 8c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8Zm1.5 2.5c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5S18.33 9 17.5 9s-1.5.67-1.5 1.5Z",create:"M20.71 5.63c.39.39.39 1.02 0 1.41l-1.83 1.83-3.75-3.75 1.83-1.83a.996.996 0 0 1 1.41 0l2.34 2.34ZM3 20.5v-3.04c0-.14.05-.26.15-.36L14.06 6.19l3.75 3.75L6.89 20.85a.47.47 0 0 1-.35.15H3.5c-.28 0-.5-.22-.5-.5Z",delete:"M15.5 4H18c.55 0 1 .45 1 1s-.45 1-1 1H6c-.55 0-1-.45-1-1s.45-1 1-1h2.5l.71-.71c.18-.18.44-.29.7-.29h4.18c.26 0 .52.11.7.29l.71.71ZM8 21c-1.1 0-2-.9-2-2V9c0-1.1.9-2 2-2h8c1.1 0 2 .9 2 2v10c0 1.1-.9 2-2 2H8Z","create portfolio":"M12 6h8c1.1 0 2 .9 2 2v10c0 1.1-.9 2-2 2H4c-1.11 0-2-.89-2-2l.01-12c0-1.11.88-2 1.99-2h5.17c.53 0 1.04.21 1.42.59L12 6Zm4 8h2c.55 0 1-.45 1-1s-.45-1-1-1h-2v-2c0-.55-.45-1-1-1s-1 .45-1 1v2h-2c-.55 0-1 .45-1 1s.45 1 1 1h2v2c0 .55.45 1 1 1s1-.45 1-1v-2Z",heatmap:"M10.5 2A3.5 3.5 0 0 1 14 5.5v6.758a5.5 5.5 0 1 1-7 0V5.499A3.5 3.5 0 0 1 10.5 2Zm0 2a1.5 1.5 0 0 0-1.493 1.355L9 5.5v7.699l-.726.6a3.5 3.5 0 1 0 4.609.137l-.156-.136-.726-.6L12 5.5a1.5 1.5 0 0 0-1.355-1.493L10.5 4Zm.5 1.5a.5.5 0 0 0-1 0v8.55a2.5 2.5 0 1 0 1 0V5.5Zm9 5.5a1 1 0 1 1 0 2h-3a1 1 0 1 1 0-2h3Zm-1-2a1 1 0 0 0-1-1h-1a1 1 0 1 0 0 2h1a1 1 0 0 0 1-1Zm1-4a1 1 0 1 1 0 2h-3a1 1 0 1 1 0-2h3Zm-1-2a1 1 0 0 0-1-1h-1a1 1 0 1 0 0 2h1a1 1 0 0 0 1-1Z",multicolor:"M6.34 19.24c-3.12-3.12-3.12-8.19 0-11.31l4.96-4.95a.996.996 0 0 1 1.41 0l4.95 4.95c3.12 3.12 3.12 8.19 0 11.31A7.98 7.98 0 0 1 12 21.58c-2.05 0-4.1-.78-5.66-2.34Zm1.42-1.41A5.928 5.928 0 0 0 12 19.59V5.1L7.76 9.35A5.928 5.928 0 0 0 6 13.59c0 1.6.62 3.1 1.76 4.24Z",info:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2Zm0 15c-.55 0-1-.45-1-1v-4c0-.55.45-1 1-1s1 .45 1 1v4c0 .55-.45 1-1 1Zm-1-8h2V7h-2v2Z",plus:"M18 13h-5v5c0 .55-.45 1-1 1s-1-.45-1-1v-5H6c-.55 0-1-.45-1-1s.45-1 1-1h5V6c0-.55.45-1 1-1s1 .45 1 1v5h5c.55 0 1 .45 1 1s-.45 1-1 1Z"};function At(l){let e,n,t,s,o,i,u,c,d,a;return{c(){e=E("button"),n=De("svg"),t=De("title"),s=ae(l[2]),o=De("path"),u=De("metadata"),c=ae(l[2]),this.h()},l(r){e=N(r,"BUTTON",{style:!0,"data-icon":!0,class:!0,title:!0,"aria-label":!0});var f=O(e);n=Le(f,"svg",{xmlns:!0,viewBox:!0,class:!0});var p=O(n);t=Le(p,"title",{});var _=O(t);s=ce(_,l[2]),_.forEach(h),o=Le(p,"path",{"fill-rule":!0,d:!0}),O(o).forEach(h),u=Le(p,"metadata",{});var L=O(u);c=ce(L,l[2]),L.forEach(h),p.forEach(h),f.forEach(h),this.h()},h(){m(o,"fill-rule","evenodd"),m(o,"d",i=ze[l[1]]),m(n,"xmlns","http://www.w3.org/2000/svg"),m(n,"viewBox","0 0 24 24"),m(n,"class","svelte-1j3ecg"),x(n,"icon-disabled",l[3]),Y(e,"--size",l[0]),m(e,"data-icon",l[1]),m(e,"class","fab svelte-1j3ecg"),m(e,"title",l[2]),m(e,"aria-label",l[2]),e.disabled=l[3]},m(r,f){P(r,e,f),b(e,n),b(n,t),b(t,s),b(n,o),b(n,u),b(u,c),d||(a=Q(e,"click",l[4]),d=!0)},p(r,[f]){f&4&&ve(s,r[2]),f&2&&i!==(i=ze[r[1]])&&m(o,"d",i),f&4&&ve(c,r[2]),f&8&&x(n,"icon-disabled",r[3]),f&1&&Y(e,"--size",r[0]),f&2&&m(e,"data-icon",r[1]),f&4&&m(e,"title",r[2]),f&4&&m(e,"aria-label",r[2]),f&8&&(e.disabled=r[3])},i:J,o:J,d(r){r&&h(e),d=!1,a()}}}function St(l,e,n){let{size:t}=e,{iconName:s}=e,{description:o}=e,{disabled:i=!1}=e;const u=new ft,c=()=>{u("iconClick")};return l.$$set=d=>{"size"in d&&n(0,t=d.size),"iconName"in d&&n(1,s=d.iconName),"description"in d&&n(2,o=d.description),"disabled"in d&&n(3,i=d.disabled)},[t,s,o,i,c]}class re extends me{constructor(e){super(),_e(this,e,St,At,fe,{size:0,iconName:1,description:2,disabled:3})}}const Vt=(l,e)=>{const n={max:0,count:{},highlighted:{}};return Dt([l,e],([t,s],o)=>{var d;if(!(s!=null&&s.tree.length)||!l){o(Ot);return}n.count={},n.highlighted=Object.entries(n.highlighted).reduce((a,[r,f])=>(a[r]=!1,a),{});const{highlightedTechniques:i,techniqueColors:u}=mt((d=t==null?void 0:t.portfolios[t.selectedPortfolio])==null?void 0:d.includedMeasures,t.measures),c=Object.entries(u).reduce((a,[r,f])=>(a[r]=[...new Set(f)],a),{});i.forEach(a=>{n.highlighted[a]=!0,n.count[a]?n.count[a]+=1:n.count[a]=1}),n.max=Object.values(n.count).reduce((a,r)=>a>r?a:r,-1/0),Object.entries(n.highlighted).forEach(([a,r])=>{if(r){const f=zt[t.techniqueMappingMode]({colors:c[a],count:n.count,max:n.max,technique:a});s.treeMap[a].classes.isHighlighted=!0,s.treeMap[a].classes.color=f}else s.treeMap[a].classes.isHighlighted=!1,s.treeMap[a].classes.color=null}),o(s)})},Zt=l=>{const{colors:e}=l,n=e.length,t=n-1,s=(1/n*100).toFixed(1);if(n===1)return e[0];let o="linear-gradient( to right,";for(let i=0;i<n;i++){const u=e[i];if(i===0){o+=` ${u} ${s}%`;continue}if(i===t){o+=`, ${u} ${s*t}%`;continue}o+=`, ${u} ${s*i}% ${s*(i+1)}%`}return o+=")",o},Ft=l=>{const{count:e,max:n,technique:t}=l,s=e[t]/n*100;return`color-mix(in srgb, green ${s<20?20:s}%, white)`},zt={multiColor:l=>Zt(l),heatMap:l=>Ft(l)},mt=(l=[],e,n=[],t={},s="#0075FF")=>{for(let o=0;o<l.length;o++){const i=e[l[o]];i.checked&&(n.push(...i.techniques),i.techniques.forEach(u=>{(t[u]||(t[u]=[]))&&t[u].push(i.color||s)})),i.children&&mt(i.children,e,n,t,i.color||s)}return{highlightedTechniques:n,techniqueColors:t}};var Ae={};function Ht(l){return l==="local"?localStorage:sessionStorage}function Ut(l,e,n){var t,s;const o=(t=n==null?void 0:n.serializer)!=null?t:JSON,i=(s=n==null?void 0:n.storage)!=null?s:"local",u=typeof window<"u"&&typeof document<"u",c=u?Ht(i):null;function d(a,r){c==null||c.setItem(a,o.stringify(r))}if(!Ae[l]){const a=Lt(e,p=>{const _=c==null?void 0:c.getItem(l);if(_?p(o.parse(_)):d(l,e),u){const L=v=>{v.key===l&&p(v.newValue?o.parse(v.newValue):null)};return window.addEventListener("storage",L),()=>window.removeEventListener("storage",L)}}),{subscribe:r,set:f}=a;Ae[l]={set(p){d(l,p),f(p)},update(p){return a.update(_=>{const L=p(_);return d(l,L),L})},subscribe:r}}return Ae[l]}const Bt=()=>{const{subscribe:l,update:e,set:n}=Ut("d3fend-measures",yt);return{subscribe:l,update:e,set:n,createPortfolio:r=>e(f=>{const p=f.portfolios.length;return r.id=p,r.includedMeasures=[],f.portfolios.push(r),f.selectedPortfolio=p,f}),deletePortfolio:()=>e(r=>(r.portfolios=r.portfolios.filter((f,p)=>p!==r.selectedPortfolio),r.selectedPortfolio=r.portfolios.length?0:null,r)),addMeasure:r=>e(f=>{var _;const p=r.name.toLowerCase();return r.id=((_=Object.values(f.measures))==null?void 0:_.length)+1,r.techniques=[],r.checked=!1,r.color="#0075FF",f.measures[p]=r,f.portfolios[f.selectedPortfolio].includedMeasures.push(p),f}),addChild:(r,f)=>e(p=>{var k;const _=((k=Object.values(p.measures))==null?void 0:k.length)||0,L=f.name.toLowerCase(),v=r.name.toLowerCase();return f.id=_+1,f.checked=!0,f.techniques=[...r.techniques],p.measures[L]=f,p.measures[v].children||(p.measures[v].children=[]),p.measures[v].children.push(L),p.measures[v].techniques=[],p}),deleteMeasure:r=>e(f=>{const p=f.selectedPortfolio;return f.portfolios=f.portfolios.reduce((_,L,v)=>{if(p===v){const k={...L};k.includedMeasures=k.includedMeasures.filter(C=>C!==r.name.toLowerCase()),_.push(k)}else _.push({...L});return _},[]),f}),deleteSubmeasure:(r,f)=>e(p=>{const _=r.name.toLowerCase();return p.measures[_].children=p.measures[_].children.filter(L=>L!==f.name.toLowerCase()),p}),saveTechniques:(r,f)=>e(p=>{const _=Object.values(r).reduce((v,k)=>(k.classes.isSelected&&v.push(k["@id"]),v),[]);return Object.entries(f).reduce((v,[k,C])=>(C&&v.push(k),v),[]).forEach(v=>{const k=[...new Set([...p.measures[v].techniques,..._])];p.measures[v].techniques=k,p.measures[v].checked=!0}),p}),saveMeasureColor:(r,f)=>e(p=>(p.measures[r.name.toLowerCase()].color=f,p))}},G=Bt();function He(l){var s;let e,n=((s=l[0])==null?void 0:s.name)+"",t;return{c(){e=E("h3"),t=ae(n),this.h()},l(o){e=N(o,"H3",{class:!0});var i=O(e);t=ce(i,n),i.forEach(h),this.h()},h(){m(e,"class","text-center")},m(o,i){P(o,e,i),b(e,t)},p(o,i){var u;i&1&&n!==(n=((u=o[0])==null?void 0:u.name)+"")&&ve(t,n)},d(o){o&&h(e)}}}function Rt(l){let e,n,t,s,o,i,u,c="<p>NAME</p>",d,a,r,f,p="<p>Description</p>",_,L,v,k,C,q="Save",$,g,M,Z="Cancel",F,X,T=l[0]&&He(l);return{c(){e=E("h2"),n=ae(l[1]),t=A(),T&&T.c(),s=A(),o=E("div"),i=E("form"),u=E("label"),u.innerHTML=c,d=A(),a=E("input"),r=A(),f=E("label"),f.innerHTML=p,_=A(),L=E("textarea"),v=A(),k=E("section"),C=E("button"),C.textContent=q,$=A(),g=E("form"),M=E("button"),M.textContent=Z,this.h()},l(w){e=N(w,"H2",{class:!0});var V=O(e);n=ce(V,l[1]),V.forEach(h),t=S(w),T&&T.l(w),s=S(w),o=N(w,"DIV",{id:!0,class:!0});var W=O(o);i=N(W,"FORM",{class:!0,autocomplete:!0});var K=O(i);u=N(K,"LABEL",{"aria-label":!0,for:!0,"data-svelte-h":!0}),le(u)!=="svelte-106jfu"&&(u.innerHTML=c),d=S(K),a=N(K,"INPUT",{id:!0,type:!0,name:!0,class:!0,"aria-describedby":!0,oninvalid:!0}),r=S(K),f=N(K,"LABEL",{"aria-label":!0,for:!0,"data-svelte-h":!0}),le(f)!=="svelte-1s39tqs"&&(f.innerHTML=p),_=S(K),L=N(K,"TEXTAREA",{id:!0,name:!0,class:!0}),O(L).forEach(h),v=S(K),k=N(K,"SECTION",{id:!0,class:!0});var ee=O(k);C=N(ee,"BUTTON",{type:!0,"data-svelte-h":!0}),le(C)!=="svelte-1f2bxem"&&(C.textContent=q),$=S(ee),g=N(ee,"FORM",{method:!0});var ne=O(g);M=N(ne,"BUTTON",{"data-svelte-h":!0}),le(M)!=="svelte-ve2mbs"&&(M.textContent=Z),ne.forEach(h),ee.forEach(h),K.forEach(h),W.forEach(h),this.h()},h(){m(e,"class","text-center"),m(u,"aria-label","-measure input"),m(u,"for","measure-name"),m(a,"id","measure-name"),m(a,"type","text"),m(a,"name","Measure"),m(a,"class","measure-input svelte-lxji7x"),a.required=!0,m(a,"aria-describedby","measurename-error"),m(a,"oninvalid",l[3]("This field is required.")),m(f,"aria-label","-measure input"),m(f,"for","measure-input"),m(L,"id","measure-description"),m(L,"name","Description"),m(L,"class","measure-input svelte-lxji7x"),L.required=!0,m(C,"type","submit"),m(g,"method","dialog"),m(k,"id","measure-btns"),m(k,"class","svelte-lxji7x"),m(i,"class","measure-input-form svelte-lxji7x"),m(i,"autocomplete","off"),m(o,"id","container-measure-form"),m(o,"class","svelte-lxji7x")},m(w,V){P(w,e,V),b(e,n),P(w,t,V),T&&T.m(w,V),P(w,s,V),P(w,o,V),b(o,i),b(i,u),b(i,d),b(i,a),b(i,r),b(i,f),b(i,_),b(i,L),b(i,v),b(i,k),b(k,C),b(k,$),b(k,g),b(g,M),l[8](i),F||(X=[Q(M,"click",l[7]),Q(i,"submit",dt(l[4]))],F=!0)},p(w,[V]){V&2&&ve(n,w[1]),w[0]?T?T.p(w,V):(T=He(w),T.c(),T.m(s.parentNode,s)):T&&(T.d(1),T=null)},i:J,o:J,d(w){w&&(h(e),h(t),h(s),h(o)),T&&T.d(w),l[8](null),F=!1,ge(X)}}}function Gt(l,e,n){let t;oe(l,G,_=>n(9,t=_));let{dialog:s}=e,{parent:o}=e,{title:i}=e,{dispatchName:u="dispatch"}=e,c;const d=new ft,a=_=>{},r=_=>{const L=_.target,v=new FormData(L),k=String(v.get("Measure")),C=String(v.get("Description")),q=k.toLocaleLowerCase();if(t.measures[q]){alert("Name must be unique");return}d(u,{dialogSubmitObject:{id:null,name:k,description:C},parent:o}),c.reset(),s.close()},f=()=>c.reset();function p(_){he[_?"unshift":"push"](()=>{c=_,n(2,c)})}return l.$$set=_=>{"dialog"in _&&n(5,s=_.dialog),"parent"in _&&n(0,o=_.parent),"title"in _&&n(1,i=_.title),"dispatchName"in _&&n(6,u=_.dispatchName)},[o,i,c,a,r,s,u,f,p]}class Se extends me{constructor(e){super(),_e(this,e,Gt,Rt,fe,{dialog:5,parent:0,title:1,dispatchName:6})}}const Kt=l=>({}),Ue=l=>({}),Jt=l=>({}),Be=l=>({});function Re(l){let e,n,t,s,o,i,u,c,d;const a=l[6].popover,r=be(a,l,l[5],Ue);return{c(){e=E("div"),n=E("div"),s=A(),o=E("div"),r&&r.c(),this.h()},l(f){e=N(f,"DIV",{role:!0,"aria-labelledby":!0,"aria-describedby":!0,class:!0,style:!0});var p=O(e);n=N(p,"DIV",{class:!0}),O(n).forEach(h),s=S(p),o=N(p,"DIV",{class:!0});var _=O(o);r&&r.l(_),_.forEach(h),p.forEach(h),this.h()},h(){m(n,"class","backdrop svelte-odell5"),m(o,"class","wrapper svelte-odell5"),m(e,"role","dialog"),m(e,"aria-labelledby","Title"),m(e,"aria-describedby","Description"),m(e,"class","popover svelte-odell5"),Y(e,"--popover-top",`${l[2]}px`),Y(e,"--popover-left",`${l[3]}px`)},m(f,p){P(f,e,p),b(e,n),b(e,s),b(e,o),r&&r.m(o,null),u=!0,c||(d=[Q(n,"click",ye(l[10])),Q(e,"click",ye(l[7]))],c=!0)},p(f,p){r&&r.p&&(!u||p&32)&&ke(r,a,f,f[5],u?Ce(a,f[5],p,Kt):we(f[5]),Ue),(!u||p&4)&&Y(e,"--popover-top",`${f[2]}px`),(!u||p&8)&&Y(e,"--popover-left",`${f[3]}px`)},i(f){u||(f&&Me(()=>{u&&(t||(t=ie(n,$e,{delay:25,duration:150},!0)),t.run(1))}),I(r,f),f&&Me(()=>{u&&(i||(i=ie(e,$e,{},!0)),i.run(1))}),u=!0)},o(f){f&&(t||(t=ie(n,$e,{delay:25,duration:150},!1)),t.run(0)),y(r,f),f&&(i||(i=ie(e,$e,{},!1)),i.run(0)),u=!1},d(f){f&&h(e),f&&t&&t.end(),r&&r.d(f),f&&i&&i.end(),c=!1,ge(d)}}}function Qt(l){let e,n,t,s,o,i;const u=l[6].popoverClick,c=be(u,l,l[5],Be);let d=l[1]&&Re(l);return{c(){e=E("div"),c&&c.c(),n=A(),d&&d.c(),t=ue()},l(a){e=N(a,"DIV",{});var r=O(e);c&&c.l(r),r.forEach(h),n=S(a),d&&d.l(a),t=ue()},m(a,r){P(a,e,r),c&&c.m(e,null),l[9](e),P(a,n,r),d&&d.m(a,r),P(a,t,r),s=!0,o||(i=[Q(window,"resize",l[4]),Q(e,"click",l[8])],o=!0)},p(a,[r]){c&&c.p&&(!s||r&32)&&ke(c,u,a,a[5],s?Ce(u,a[5],r,Jt):we(a[5]),Be),a[1]?d?(d.p(a,r),r&2&&I(d,1)):(d=Re(a),d.c(),I(d,1),d.m(t.parentNode,t)):d&&(de(),y(d,1,1,()=>{d=null}),pe())},i(a){s||(I(c,a),I(d),s=!0)},o(a){y(c,a),y(d),s=!1},d(a){a&&(h(e),h(n),h(t)),c&&c.d(a),l[9](null),d&&d.d(a),o=!1,ge(i)}}}function Xt(l,e,n){let{$$slots:t={},$$scope:s}=e,o=!1,i,u,c;const d=()=>setTimeout(()=>{n(2,{bottom:u,left:c}=(i==null?void 0:i.getBoundingClientRect())??{bottom:0,left:0},u,n(3,c))},1e3);function a(_){vt.call(this,l,_)}const r=()=>n(1,o=!0);function f(_){he[_?"unshift":"push"](()=>{i=_,n(0,i)})}const p=()=>n(1,o=!1);return l.$$set=_=>{"$$scope"in _&&n(5,s=_.$$scope)},l.$$.update=()=>{l.$$.dirty&1&&d()},[i,o,u,c,d,s,t,a,r,f,p]}class Wt extends me{constructor(e){super(),_e(this,e,Xt,Qt,fe,{})}}function Yt(l){let e,n;return e=new re({props:{size:30,iconName:"setting",description:"Change Layout",slot:"popoverClick"}}),{c(){H(e.$$.fragment)},l(t){U(e.$$.fragment,t)},m(t,s){B(e,t,s),n=!0},p:J,i(t){n||(I(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){R(e,t)}}}function xt(l){let e,n,t,s,o,i="Heatmap",u,c,d,a,r,f="Multi-Colored",p,_,L;return t=new re({props:{size:30,iconName:"heatmap",description:"Heatmap"}}),d=new re({props:{size:30,iconName:"multicolor",description:"MultiColor"}}),{c(){e=E("div"),n=E("button"),H(t.$$.fragment),s=A(),o=E("span"),o.textContent=i,u=A(),c=E("button"),H(d.$$.fragment),a=A(),r=E("span"),r.textContent=f,this.h()},l(v){e=N(v,"DIV",{id:!0,slot:!0,class:!0});var k=O(e);n=N(k,"BUTTON",{class:!0});var C=O(n);U(t.$$.fragment,C),s=S(C),o=N(C,"SPAN",{class:!0,"data-svelte-h":!0}),le(o)!=="svelte-1cpq3q6"&&(o.textContent=i),C.forEach(h),u=S(k),c=N(k,"BUTTON",{class:!0});var q=O(c);U(d.$$.fragment,q),a=S(q),r=N(q,"SPAN",{class:!0,"data-svelte-h":!0}),le(r)!=="svelte-17kog5w"&&(r.textContent=f),q.forEach(h),k.forEach(h),this.h()},h(){m(o,"class","pop-text"),m(n,"class","btn svelte-bsc48l"),m(r,"class","pop-text"),m(c,"class","btn svelte-bsc48l"),m(e,"id","btn-group"),m(e,"slot","popover"),m(e,"class","svelte-bsc48l")},m(v,k){P(v,e,k),b(e,n),B(t,n,null),b(n,s),b(n,o),b(e,u),b(e,c),B(d,c,null),b(c,a),b(c,r),p=!0,_||(L=[Q(n,"click",l[16]),Q(c,"click",l[17])],_=!0)},p:J,i(v){p||(I(t.$$.fragment,v),I(d.$$.fragment,v),p=!0)},o(v){y(t.$$.fragment,v),y(d.$$.fragment,v),p=!1},d(v){v&&h(e),R(t),R(d),_=!1,ge(L)}}}function el(l){var T;let e,n,t="D3FEND PROFILE",s,o,i,u,c,d,a,r,f,p,_,L,v,k,C,q,$,g,M,Z;i=new re({props:{size:33,iconName:"create portfolio",description:"Create Portfolio"}}),i.$on("iconClick",l[11]);function F(w){l[13](w)}let X={inputClassName:"autocomplete-cursor-select",items:(T=l[3])==null?void 0:T.portfolios,readonly:!1,labelFieldName:"name",onChange:l[12]};return l[2]!==void 0&&(X.selectedItem=l[2]),c=new Ct({props:X}),he.push(()=>Mt(c,"selectedItem",F)),f=new re({props:{size:33,iconName:"plus",description:"Create Capability",disabled:!l[3].portfolios.length>0}}),f.$on("iconClick",l[14]),_=new re({props:{size:33,iconName:"delete",description:"Delete Portfolio"}}),_.$on("iconClick",l[15]),v=new Wt({props:{$$slots:{popover:[xt],popoverClick:[Yt]},$$scope:{ctx:l}}}),q=new Se({props:{dialog:l[0],title:"Create Capability"}}),q.$on("dispatch",l[18]),M=new Se({props:{dialog:l[1],title:"Create Portfolio"}}),M.$on("dispatch",l[20]),{c(){e=E("section"),n=E("h2"),n.textContent=t,s=A(),o=E("div"),H(i.$$.fragment),u=A(),H(c.$$.fragment),a=A(),r=E("div"),H(f.$$.fragment),p=A(),H(_.$$.fragment),L=A(),H(v.$$.fragment),k=A(),C=E("dialog"),H(q.$$.fragment),$=A(),g=E("dialog"),H(M.$$.fragment),this.h()},l(w){e=N(w,"SECTION",{id:!0,class:!0});var V=O(e);n=N(V,"H2",{class:!0,"data-svelte-h":!0}),le(n)!=="svelte-j94ybk"&&(n.textContent=t),s=S(V),o=N(V,"DIV",{id:!0,class:!0});var W=O(o);U(i.$$.fragment,W),u=S(W),U(c.$$.fragment,W),a=S(W),r=N(W,"DIV",{id:!0,class:!0});var K=O(r);U(f.$$.fragment,K),p=S(K),U(_.$$.fragment,K),L=S(K),U(v.$$.fragment,K),K.forEach(h),W.forEach(h),V.forEach(h),k=S(w),C=N(w,"DIALOG",{});var ee=O(C);U(q.$$.fragment,ee),ee.forEach(h),$=S(w),g=N(w,"DIALOG",{});var ne=O(g);U(M.$$.fragment,ne),ne.forEach(h),this.h()},h(){m(n,"class","text-center fancy-font"),m(r,"id","measure-btns"),m(r,"class","svelte-bsc48l"),m(o,"id","portfolio-controls"),m(o,"class","svelte-bsc48l"),m(e,"id","container-portfolio"),m(e,"class","svelte-bsc48l")},m(w,V){P(w,e,V),b(e,n),b(e,s),b(e,o),B(i,o,null),b(o,u),B(c,o,null),b(o,a),b(o,r),B(f,r,null),b(r,p),B(_,r,null),b(r,L),B(v,r,null),P(w,k,V),P(w,C,V),B(q,C,null),l[19](C),P(w,$,V),P(w,g,V),B(M,g,null),l[21](g),Z=!0},p(w,[V]){var Ie;const W={};V&8&&(W.items=(Ie=w[3])==null?void 0:Ie.portfolios),!d&&V&4&&(d=!0,W.selectedItem=w[2],bt(()=>d=!1)),c.$set(W);const K={};V&8&&(K.disabled=!w[3].portfolios.length>0),f.$set(K);const ee={};V&4194304&&(ee.$$scope={dirty:V,ctx:w}),v.$set(ee);const ne={};V&1&&(ne.dialog=w[0]),q.$set(ne);const Ne={};V&2&&(Ne.dialog=w[1]),M.$set(Ne)},i(w){Z||(I(i.$$.fragment,w),I(c.$$.fragment,w),I(f.$$.fragment,w),I(_.$$.fragment,w),I(v.$$.fragment,w),I(q.$$.fragment,w),I(M.$$.fragment,w),Z=!0)},o(w){y(i.$$.fragment,w),y(c.$$.fragment,w),y(f.$$.fragment,w),y(_.$$.fragment,w),y(v.$$.fragment,w),y(q.$$.fragment,w),y(M.$$.fragment,w),Z=!1},d(w){w&&(h(e),h(k),h(C),h($),h(g)),R(i),R(c),R(f),R(_),R(v),R(q),l[19](null),R(M),l[21](null)}}}function tl(l,e,n){var X;let t;oe(l,G,T=>n(3,t=T));let s,o,i=((X=t==null?void 0:t.portfolios)==null?void 0:X[t==null?void 0:t.selectedPortfolio])||null;const u=T=>{var w;if(T){const V=t.portfolios.findIndex(({id:W})=>W===T.id);te(G,t.selectedPortfolio=V,t),n(2,i=((w=t==null?void 0:t.portfolios)==null?void 0:w[V])||null),se.reset()}else te(G,t.selectedPortfolio=null,t),n(2,i=T)},c=()=>{o.showModal()},d=T=>{s.showModal()},a=T=>{const{dialogSubmitObject:w}=T.detail;G.addMeasure(w)},r=T=>{const{dialogSubmitObject:w}=T.detail;G.createPortfolio(w),n(2,i=t.portfolios[t.selectedPortfolio]||null)},f=T=>{confirm("Deleting Portfolio will delete whole portfolio.")&&(G.deletePortfolio(),n(2,i=t.portfolios[t.selectedPortfolio]||{name:""}))},p=T=>{te(G,t.techniqueMappingMode=T,t)},_=T=>c(),L=T=>u(T);function v(T){i=T,n(2,i)}const k=T=>d(),C=T=>f(),q=()=>p("heatMap"),$=()=>p("multiColor"),g=T=>a(T);function M(T){he[T?"unshift":"push"](()=>{s=T,n(0,s)})}const Z=T=>r(T);function F(T){he[T?"unshift":"push"](()=>{o=T,n(1,o)})}return[s,o,i,t,u,c,d,a,r,f,p,_,L,v,k,C,q,$,g,M,Z,F]}class ll extends me{constructor(e){super(),_e(this,e,tl,el,fe,{})}}function Ge(l,e,n){const t=l.slice();return t[6]=e[n],t[8]=n,t}const nl=l=>({capability:l&512,parent:l&5,level:l&2,idx:l&256}),Ke=l=>({capability:l[9],parent:l[6],level:l[1],idx:l[8]}),sl=l=>({capability:l&5,level:l&2}),Je=l=>({parent:null,capability:l[6],level:l[1],idx:l[8]});function il(l){let e;return{c(){e=ae("No slot")},l(n){e=ce(n,"No slot")},m(n,t){P(n,e,t)},d(n){n&&h(e)}}}function Qe(l){let e,n;return e=new _t({props:{capabilities:l[6].children,level:l[1]+1,$$slots:{default:[rl,({capability:t,level:s,idx:o})=>({9:t,1:s,8:o}),({capability:t,level:s,idx:o})=>(t?512:0)|(s?2:0)|(o?256:0)]},$$scope:{ctx:l}}}),{c(){H(e.$$.fragment)},l(t){U(e.$$.fragment,t)},m(t,s){B(e,t,s),n=!0},p(t,s){const o={};s&5&&(o.capabilities=t[6].children),s&2&&(o.level=t[1]+1),s&807&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){n||(I(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){R(e,t)}}}function ol(l){let e;return{c(){e=ae("No slot")},l(n){e=ce(n,"No slot")},m(n,t){P(n,e,t)},d(n){n&&h(e)}}}function Xe(l){let e;const n=l[3].default,t=be(n,l,l[5],Ke),s=t||ol();return{c(){s&&s.c()},l(o){s&&s.l(o)},m(o,i){s&&s.m(o,i),e=!0},p(o,i){t&&t.p&&(!e||i&807)&&ke(t,n,o,o[5],e?Ce(n,o[5],i,nl):we(o[5]),Ke)},i(o){e||(I(s,o),e=!0)},o(o){y(s,o),e=!1},d(o){s&&s.d(o)}}}function rl(l){let e=l[6],n,t,s=Xe(l);return{c(){s.c(),n=A()},l(o){s.l(o),n=S(o)},m(o,i){s.m(o,i),P(o,n,i),t=!0},p(o,i){i&5&&fe(e,e=o[6])?(de(),y(s,1,1,J),pe(),s=Xe(o),s.c(),I(s,1),s.m(n.parentNode,n)):s.p(o,i)},i(o){t||(I(s),t=!0)},o(o){y(s),t=!1},d(o){o&&h(n),s.d(o)}}}function We(l){var c,d;let e,n,t;const s=l[3].default,o=be(s,l,l[5],Je),i=o||il();let u=((d=(c=l[6])==null?void 0:c.children)==null?void 0:d.length)>0&&Qe(l);return{c(){i&&i.c(),e=A(),u&&u.c(),n=ue()},l(a){i&&i.l(a),e=S(a),u&&u.l(a),n=ue()},m(a,r){i&&i.m(a,r),P(a,e,r),u&&u.m(a,r),P(a,n,r),t=!0},p(a,r){var f,p;o&&o.p&&(!t||r&39)&&ke(o,s,a,a[5],t?Ce(s,a[5],r,sl):we(a[5]),Je),((p=(f=a[6])==null?void 0:f.children)==null?void 0:p.length)>0?u?(u.p(a,r),r&5&&I(u,1)):(u=Qe(a),u.c(),I(u,1),u.m(n.parentNode,n)):u&&(de(),y(u,1,1,()=>{u=null}),pe())},i(a){t||(I(i,a),I(u),t=!0)},o(a){y(i,a),y(u),t=!1},d(a){a&&(h(e),h(n)),i&&i.d(a),u&&u.d(a)}}}function al(l){let e,n,t=je(l[0].map(l[4])),s=[];for(let i=0;i<t.length;i+=1)s[i]=We(Ge(l,t,i));const o=i=>y(s[i],1,1,()=>{s[i]=null});return{c(){e=E("section");for(let i=0;i<s.length;i+=1)s[i].c();this.h()},l(i){e=N(i,"SECTION",{style:!0});var u=O(e);for(let c=0;c<s.length;c+=1)s[c].l(u);u.forEach(h),this.h()},h(){Y(e,"--level",l[1])},m(i,u){P(i,e,u);for(let c=0;c<s.length;c+=1)s[c]&&s[c].m(e,null);n=!0},p(i,[u]){if(u&807){t=je(i[0].map(i[4]));let c;for(c=0;c<t.length;c+=1){const d=Ge(i,t,c);s[c]?(s[c].p(d,u),I(s[c],1)):(s[c]=We(d),s[c].c(),I(s[c],1),s[c].m(e,null))}for(de(),c=t.length;c<s.length;c+=1)o(c);pe()}(!n||u&2)&&Y(e,"--level",i[1])},i(i){if(!n){for(let u=0;u<t.length;u+=1)I(s[u]);n=!0}},o(i){s=s.filter(Boolean);for(let u=0;u<s.length;u+=1)y(s[u]);n=!1},d(i){i&&h(e),pt(s,i)}}}function cl(l,e,n){let t;oe(l,G,d=>n(2,t=d));let{$$slots:s={},$$scope:o}=e,{capabilities:i=[]}=e,{level:u=0}=e;const c=d=>t.measures[d.toLowerCase()];return l.$$set=d=>{"capabilities"in d&&n(0,i=d.capabilities),"level"in d&&n(1,u=d.level),"$$scope"in d&&n(5,o=d.$$scope)},[i,u,t,s,c,o]}class _t extends me{constructor(e){super(),_e(this,e,cl,al,fe,{capabilities:0,level:1})}}function ul(l){let e,n,t,s,o,i,u,c=l[36].name+"",d,a,r,f=l[0][l[36].name.toLowerCase()],p,_,L;function v(...$){return l[27](l[36],l[7],...$)}let k=f&&Ye(l);function C(...$){return l[29](l[36],l[37],...$)}function q(...$){return l[30](l[36],...$)}return{c(){e=E("article"),n=E("div"),t=E("div"),s=E("input"),i=A(),u=E("span"),d=ae(c),r=A(),k&&k.c(),this.h()},l($){e=N($,"ARTICLE",{class:!0});var g=O(e);n=N(g,"DIV",{class:!0,tabindex:!0,role:!0});var M=O(n);t=N(M,"DIV",{class:!0});var Z=O(t);s=N(Z,"INPUT",{class:!0,type:!0,name:!0,style:!0}),i=S(Z),u=N(Z,"SPAN",{class:!0,title:!0});var F=O(u);d=ce(F,c),F.forEach(h),Z.forEach(h),r=S(M),k&&k.l(M),M.forEach(h),g.forEach(h),this.h()},h(){var $;m(s,"class","check-box svelte-1yjwnw9"),m(s,"type","checkbox"),m(s,"name","include"),s.checked=o=($=l[36])==null?void 0:$.checked,Y(s,"accent-color",l[7].color),m(u,"class","measure-text svelte-1yjwnw9"),m(u,"title",a=l[36].description),m(t,"class","child-row svelte-1yjwnw9"),m(n,"class","measure-child measure-hover svelte-1yjwnw9"),m(n,"tabindex","0"),m(n,"role","button"),x(n,"selected-measure",l[0][l[36].name.toLowerCase()]),m(e,"class","container-measure-child svelte-1yjwnw9")},m($,g){P($,e,g),b(e,n),b(n,t),b(t,s),b(t,i),b(t,u),b(u,d),b(n,r),k&&k.m(n,null),p=!0,_||(L=[Q(s,"click",ye(v)),Q(n,"click",C),Q(n,"keydown",q)],_=!0)},p($,g){var M;l=$,(!p||g[1]&32&&o!==(o=(M=l[36])==null?void 0:M.checked))&&(s.checked=o),(!p||g[0]&128)&&Y(s,"accent-color",l[7].color),(!p||g[1]&32)&&c!==(c=l[36].name+"")&&ve(d,c),(!p||g[1]&32&&a!==(a=l[36].description))&&m(u,"title",a),g[0]&1|g[1]&32&&(f=l[0][l[36].name.toLowerCase()]),f?k?(k.p(l,g),g[0]&1|g[1]&32&&I(k,1)):(k=Ye(l),k.c(),I(k,1),k.m(n,null)):k&&(de(),y(k,1,1,()=>{k=null}),pe()),(!p||g[0]&1|g[1]&32)&&x(n,"selected-measure",l[0][l[36].name.toLowerCase()])},i($){p||(I(k),p=!0)},o($){y(k),p=!1},d($){$&&h(e),k&&k.d(),_=!1,ge(L)}}}function fl(l){var q;let e,n,t,s,o,i,u=l[36].name+"",c,d,a=l[0][l[36].name.toLowerCase()]||((q=l[36].children)==null?void 0:q.some(l[18])),r,f,p,_;function L(...$){return l[19](l[36],...$)}let v=a&&xe(l);function k(...$){return l[25](l[36],...$)}function C(...$){return l[26](l[36],...$)}return{c(){e=E("div"),n=E("form"),t=E("input"),o=A(),i=E("span"),c=ae(u),d=A(),v&&v.c(),this.h()},l($){e=N($,"DIV",{class:!0,tabindex:!0,role:!0,title:!0});var g=O(e);n=N(g,"FORM",{});var M=O(n);t=N(M,"INPUT",{class:!0,type:!0,name:!0,tabindex:!0,style:!0}),M.forEach(h),o=S(g),i=N(g,"SPAN",{class:!0});var Z=O(i);c=ce(Z,u),Z.forEach(h),d=S(g),v&&v.l(g),g.forEach(h),this.h()},h(){var $,g,M,Z;m(t,"class","check-box svelte-1yjwnw9"),m(t,"type","checkbox"),m(t,"name","include"),t.checked=s=($=l[36])==null?void 0:$.checked,m(t,"tabindex","0"),Y(t,"accent-color",l[36].color),m(i,"class","measure-text svelte-1yjwnw9"),x(i,"parent-measure",((g=l[36].children)==null?void 0:g.length)>0),m(e,"class","measure-parent svelte-1yjwnw9"),m(e,"tabindex","0"),m(e,"role","button"),m(e,"title",r=`Definition: 

`+l[36].description),x(e,"selected-measure",l[0][l[36].name.toLowerCase()]),x(e,"measure-hover",!((Z=(M=l[36])==null?void 0:M.children)!=null&&Z.length))},m($,g){P($,e,g),b(e,n),b(n,t),b(e,o),b(e,i),b(i,c),b(e,d),v&&v.m(e,null),f=!0,p||(_=[Q(t,"click",ye(L)),Q(e,"click",k),Q(e,"keydown",C)],p=!0)},p($,g){var M,Z,F,X,T;l=$,(!f||g[1]&32&&s!==(s=(M=l[36])==null?void 0:M.checked))&&(t.checked=s),(!f||g[1]&32)&&Y(t,"accent-color",l[36].color),(!f||g[1]&32)&&u!==(u=l[36].name+"")&&ve(c,u),(!f||g[1]&32)&&x(i,"parent-measure",((Z=l[36].children)==null?void 0:Z.length)>0),g[0]&1|g[1]&32&&(a=l[0][l[36].name.toLowerCase()]||((F=l[36].children)==null?void 0:F.some(l[18]))),a?v?(v.p(l,g),g[0]&1|g[1]&32&&I(v,1)):(v=xe(l),v.c(),I(v,1),v.m(e,null)):v&&(de(),y(v,1,1,()=>{v=null}),pe()),(!f||g[1]&32&&r!==(r=`Definition: 

`+l[36].description))&&m(e,"title",r),(!f||g[0]&1|g[1]&32)&&x(e,"selected-measure",l[0][l[36].name.toLowerCase()]),(!f||g[1]&32)&&x(e,"measure-hover",!((T=(X=l[36])==null?void 0:X.children)!=null&&T.length))},i($){f||(I(v),f=!0)},o($){y(v),f=!1},d($){$&&h(e),v&&v.d(),p=!1,ge(_)}}}function Ye(l){let e,n,t,s;function o(...i){return l[28](l[7],l[36],...i)}return n=new re({props:{size:28,iconName:"delete",description:"Delete Capability"}}),n.$on("iconClick",o),{c(){e=E("div"),H(n.$$.fragment),this.h()},l(i){e=N(i,"DIV",{class:!0});var u=O(e);U(n.$$.fragment,u),u.forEach(h),this.h()},h(){m(e,"class","measure-btns svelte-1yjwnw9")},m(i,u){P(i,e,u),B(n,e,null),s=!0},p(i,u){l=i},i(i){s||(I(n.$$.fragment,i),i&&Me(()=>{s&&(t||(t=ie(e,Oe,{axis:"x",duration:200,x:10},!0)),t.run(1))}),s=!0)},o(i){y(n.$$.fragment,i),i&&(t||(t=ie(e,Oe,{axis:"x",duration:200,x:10},!1)),t.run(0)),s=!1},d(i){i&&h(e),R(n),i&&t&&t.end()}}}function xe(l){let e,n,t,s,o,i,u;function c(...r){return l[20](l[36],...r)}n=new re({props:{size:30,iconName:"plus",description:"Create Capability Child"}}),n.$on("iconClick",c);function d(...r){return l[21](l[36],...r)}s=new re({props:{size:30,iconName:"delete",description:"Delete Capability and Children"}}),s.$on("iconClick",d);let a=l[1].techniqueMappingMode==="multiColor"&&et(l);return{c(){e=E("div"),H(n.$$.fragment),t=A(),H(s.$$.fragment),o=A(),a&&a.c(),this.h()},l(r){e=N(r,"DIV",{class:!0});var f=O(e);U(n.$$.fragment,f),t=S(f),U(s.$$.fragment,f),o=S(f),a&&a.l(f),f.forEach(h),this.h()},h(){m(e,"class","measure-btns svelte-1yjwnw9")},m(r,f){P(r,e,f),B(n,e,null),b(e,t),B(s,e,null),b(e,o),a&&a.m(e,null),u=!0},p(r,f){l=r,l[1].techniqueMappingMode==="multiColor"?a?(a.p(l,f),f[0]&2&&I(a,1)):(a=et(l),a.c(),I(a,1),a.m(e,null)):a&&(de(),y(a,1,1,()=>{a=null}),pe())},i(r){u||(I(n.$$.fragment,r),I(s.$$.fragment,r),I(a),Me(()=>{u&&(i||(i=ie(e,Oe,{axis:"x",duration:100,x:10},!0)),i.run(1))}),u=!0)},o(r){y(n.$$.fragment,r),y(s.$$.fragment,r),y(a),i||(i=ie(e,Oe,{axis:"x",duration:100,x:10},!1)),i.run(0),u=!1},d(r){r&&h(e),R(n),R(s),a&&a.d(),r&&i&&i.end()}}}function et(l){let e,n,t,s,o=l[37],i,u,c;function d(...p){return l[22](l[36],l[37],...p)}e=new re({props:{size:30,iconName:"color picker",description:"Pick Capability Family Color"}}),e.$on("iconClick",d);const a=()=>l[23](t,o),r=()=>l[23](null,o);function f(...p){return l[24](l[36],l[37],...p)}return{c(){H(e.$$.fragment),n=A(),t=E("input"),this.h()},l(p){U(e.$$.fragment,p),n=S(p),t=N(p,"INPUT",{type:!0,id:!0,name:!0,style:!0}),this.h()},h(){m(t,"type","color"),m(t,"id","head"),m(t,"name","head"),t.value=s=l[36].color,Y(t,"display","none")},m(p,_){B(e,p,_),P(p,n,_),P(p,t,_),a(),i=!0,u||(c=Q(t,"input",f),u=!0)},p(p,_){l=p,(!i||_[1]&32&&s!==(s=l[36].color))&&(t.value=s),o!==l[37]&&(r(),o=l[37],a())},i(p){i||(I(e.$$.fragment,p),i=!0)},o(p){y(e.$$.fragment,p),i=!1},d(p){p&&(h(n),h(t)),R(e,p),r(),u=!1,c()}}}function dl(l){let e,n,t,s;const o=[fl,ul],i=[];function u(c,d){return c[38]===0?0:c[38]===1?1:-1}return~(e=u(l))&&(n=i[e]=o[e](l)),{c(){n&&n.c(),t=ue()},l(c){n&&n.l(c),t=ue()},m(c,d){~e&&i[e].m(c,d),P(c,t,d),s=!0},p(c,d){let a=e;e=u(c),e===a?~e&&i[e].p(c,d):(n&&(de(),y(i[a],1,1,()=>{i[a]=null}),pe()),~e?(n=i[e],n?n.p(c,d):(n=i[e]=o[e](c),n.c()),I(n,1),n.m(t.parentNode,t)):n=null)},i(c){s||(I(n),s=!0)},o(c){y(n),s=!1},d(c){c&&h(t),~e&&i[e].d(c)}}}function pl(l){var $;let e,n,t,s,o,i,u,c,d,a,r,f,p,_,L,v,k,C,q;return t=new ll({}),i=new _t({props:{capabilities:(($=l[5])==null?void 0:$.includedMeasures)||[],$$slots:{default:[dl,({capability:g,idx:M,level:Z,parent:F})=>({36:g,37:M,38:Z,7:F}),({capability:g,idx:M,level:Z,parent:F})=>[F?128:0,(g?32:0)|(M?64:0)|(Z?128:0)]]},$$scope:{ctx:l}}}),_=new Se({props:{dialog:l[2],parent:l[7],title:"Create child capability of:"}}),_.$on("dispatch",l[32]),{c(){e=E("main"),n=E("section"),H(t.$$.fragment),s=A(),o=E("section"),H(i.$$.fragment),u=A(),c=E("section"),d=E("div"),a=E("button"),r=ae("Save Techniques"),f=A(),p=E("dialog"),H(_.$$.fragment),this.h()},l(g){e=N(g,"MAIN",{class:!0});var M=O(e);n=N(M,"SECTION",{id:!0,class:!0});var Z=O(n);U(t.$$.fragment,Z),Z.forEach(h),s=S(M),o=N(M,"SECTION",{id:!0,class:!0});var F=O(o);U(i.$$.fragment,F),F.forEach(h),u=S(M),c=N(M,"SECTION",{id:!0,class:!0});var X=O(c);d=N(X,"DIV",{id:!0,class:!0});var T=O(d);a=N(T,"BUTTON",{class:!0,type:!0});var w=O(a);r=ce(w,"Save Techniques"),w.forEach(h),T.forEach(h),X.forEach(h),f=S(M),p=N(M,"DIALOG",{});var V=O(p);U(_.$$.fragment,V),V.forEach(h),M.forEach(h),this.h()},h(){m(n,"id","container-header"),m(n,"class","svelte-1yjwnw9"),m(o,"id","container-measure"),m(o,"class","svelte-1yjwnw9"),m(a,"class","control-btn svelte-1yjwnw9"),m(a,"type","button"),a.disabled=l[4],m(d,"id","row-persist-btns"),m(d,"class","svelte-1yjwnw9"),m(c,"id","container-btns"),m(c,"class","svelte-1yjwnw9"),m(e,"class","svelte-1yjwnw9")},m(g,M){P(g,e,M),b(e,n),B(t,n,null),b(e,s),b(e,o),B(i,o,null),b(e,u),b(e,c),b(c,d),b(d,a),b(a,r),b(e,f),b(e,p),B(_,p,null),l[33](p),k=!0,C||(q=Q(a,"click",l[31]),C=!0)},p(g,M){var X;const Z={};M[0]&32&&(Z.capabilities=((X=g[5])==null?void 0:X.includedMeasures)||[]),M[0]&139|M[1]&480&&(Z.$$scope={dirty:M,ctx:g}),i.$set(Z),(!k||M[0]&16)&&(a.disabled=g[4]);const F={};M[0]&4&&(F.dialog=g[2]),M[0]&128&&(F.parent=g[7]),_.$set(F)},i(g){k||(I(t.$$.fragment,g),I(i.$$.fragment,g),I(_.$$.fragment,g),g&&Me(()=>{k&&(v&&v.end(1),L=Et(e,$e,{delay:400}),L.start())}),k=!0)},o(g){y(t.$$.fragment,g),y(i.$$.fragment,g),y(_.$$.fragment,g),L&&L.invalidate(),g&&(v=Nt(e,$e,{duration:100})),k=!1},d(g){g&&h(e),R(t),R(i),R(_),l[33](null),g&&v&&v.end(),C=!1,q()}}}function ml(l,e,n){let t,s,o;oe(l,G,D=>n(1,s=D)),oe(l,se,D=>n(6,o=D));let i,u,c=[],d=!0,a={};const r=(D,j)=>{var Ee;if(s.isReadonly||(Ee=j==null?void 0:j.children)!=null&&Ee.length)return;const z=j.name.toLowerCase();if(D.shiftKey)n(0,a[z]=!a[z],a);else{const Te=a[z];Object.entries(a).forEach(([Pe])=>{n(0,a[Pe]=!1,a)}),n(0,a[z]=!Te,a)}},f=(D,j,z)=>{D.code==="Enter"&&j(D,z)},p=(D,j,z)=>{var Te;const Ee=(Te=s.measures[j.name.toLowerCase()])==null?void 0:Te.checked;te(G,s.measures[j.name.toLowerCase()].checked=!Ee,s),j.children&&j.children.forEach(Pe=>{te(G,s.measures[Pe.toLowerCase()].checked=!Ee,s)})},_=D=>{n(7,u=D),i.showModal()},L=D=>{const{parent:j,dialogSubmitObject:z}=D.detail;G.addChild(j,z)},v=(D,j)=>{G.deleteMeasure(j)},k=(D,j,z)=>{G.deleteSubmeasure(j,z)},C=(D,j,z)=>{G.saveTechniques(j,z),se.reset()},q=(D,j,z)=>{z.click()},$=(D,j)=>{G.saveMeasureColor(j,D.srcElement.value)},g=D=>a[D],M=(D,j)=>p(j,D),Z=(D,j)=>_(D),F=(D,j)=>v(j,D),X=(D,j,z)=>q(z,D,c[j]);function T(D,j){he[D?"unshift":"push"](()=>{c[j]=D,n(3,c)})}const w=(D,j,z)=>$(z,D,c[j]),V=(D,j)=>r(j,D),W=(D,j)=>f(j,r,D),K=(D,j,z)=>p(z,D),ee=(D,j,z)=>k(z,D,j),ne=(D,j,z)=>r(z,D),Ne=(D,j)=>f(j,r,D),Ie=D=>C(D,o.treeMap,a),ht=D=>L(D);function gt(D){he[D?"unshift":"push"](()=>{i=D,n(2,i)})}return l.$$.update=()=>{var D;l.$$.dirty[0]&2&&n(5,t=(D=s==null?void 0:s.portfolios)==null?void 0:D[s==null?void 0:s.selectedPortfolio]),l.$$.dirty[0]&1&&n(4,d=!Object.values(a).some(j=>j))},[a,s,i,c,d,t,o,u,r,f,p,_,L,v,k,C,q,$,g,M,Z,F,X,T,w,V,W,K,ee,ne,Ne,Ie,ht,gt]}class _l extends me{constructor(e){super(),_e(this,e,ml,pl,fe,{},null,[-1,-1])}}const hl=l=>({}),tt=l=>({}),gl=l=>({}),lt=l=>({id:"matrix-slot"}),vl=l=>({}),nt=l=>({});function st(l){let e,n,t;const s=l[2].drawer,o=be(s,l,l[1],nt);return{c(){e=E("aside"),o&&o.c(),this.h()},l(i){e=N(i,"ASIDE",{id:!0,class:!0});var u=O(e);o&&o.l(u),u.forEach(h),this.h()},h(){m(e,"id","container-drawer"),m(e,"class","svelte-1u5pphb"),x(e,"drawer-closed",!l[0].isDrawerOpen)},m(i,u){P(i,e,u),o&&o.m(e,null),t=!0},p(i,u){l=i,o&&o.p&&(!t||u&2)&&ke(o,s,l,l[1],t?Ce(s,l[1],u,vl):we(l[1]),nt),(!t||u&1)&&x(e,"drawer-closed",!l[0].isDrawerOpen)},i(i){t||(I(o,i),i&&Me(()=>{t&&(n||(n=ie(e,Fe,{axis:"x",duration:Ve},!0)),n.run(1))}),t=!0)},o(i){y(o,i),i&&(n||(n=ie(e,Fe,{axis:"x",duration:Ve},!1)),n.run(0)),t=!1},d(i){i&&h(e),o&&o.d(i),i&&n&&n.end()}}}function bl(l){let e,n,t,s,o,i=l[0].isDrawerOpen&&st(l);const u=l[2].matrix,c=be(u,l,l[1],lt),d=l[2].legend,a=be(d,l,l[1],tt);return{c(){e=E("main"),i&&i.c(),n=A(),t=E("section"),c&&c.c(),s=A(),a&&a.c(),this.h()},l(r){e=N(r,"MAIN",{style:!0,class:!0});var f=O(e);i&&i.l(f),n=S(f),t=N(f,"SECTION",{id:!0,class:!0});var p=O(t);c&&c.l(p),s=S(p),a&&a.l(p),p.forEach(h),f.forEach(h),this.h()},h(){m(t,"id","container-matrix"),m(t,"class","svelte-1u5pphb"),x(t,"expand-matrix",l[0].isDrawerOpen),Y(e,"--drawer-width",kl),Y(e,"--ANIMATION_TIMING",Ve),m(e,"class","svelte-1u5pphb")},m(r,f){P(r,e,f),i&&i.m(e,null),b(e,n),b(e,t),c&&c.m(t,null),b(t,s),a&&a.m(t,null),o=!0},p(r,[f]){r[0].isDrawerOpen?i?(i.p(r,f),f&1&&I(i,1)):(i=st(r),i.c(),I(i,1),i.m(e,n)):i&&(de(),y(i,1,1,()=>{i=null}),pe()),c&&c.p&&(!o||f&2)&&ke(c,u,r,r[1],o?Ce(u,r[1],f,gl):we(r[1]),lt),a&&a.p&&(!o||f&2)&&ke(a,d,r,r[1],o?Ce(d,r[1],f,hl):we(r[1]),tt),(!o||f&1)&&x(t,"expand-matrix",r[0].isDrawerOpen)},i(r){o||(I(i),I(c,r),I(a,r),o=!0)},o(r){y(i),y(c,r),y(a,r),o=!1},d(r){r&&h(e),i&&i.d(),c&&c.d(r),a&&a.d(r)}}}const Ve=1e3;let kl="25vw";function wl(l,e,n){let t;oe(l,G,i=>n(0,t=i));let{$$slots:s={},$$scope:o}=e;return l.$$set=i=>{"$$scope"in i&&n(1,o=i.$$scope)},[t,o,s]}class Cl extends me{constructor(e){super(),_e(this,e,wl,bl,fe,{})}}function it(l,e,n){const t=l.slice();return t[5]=e[n],t}function ot(l){let e,n=je(l[1].map(l[4]).reverse()),t=[];for(let s=0;s<n.length;s+=1)t[s]=at(it(l,n,s));return{c(){e=E("div");for(let s=0;s<t.length;s+=1)t[s].c();this.h()},l(s){e=N(s,"DIV",{id:!0,class:!0});var o=O(e);for(let i=0;i<t.length;i+=1)t[i].l(o);o.forEach(h),this.h()},h(){m(e,"id","legend"),m(e,"class","svelte-j56lk0")},m(s,o){P(s,e,o);for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(e,null)},p(s,o){if(o&3){n=je(s[1].map(s[4]).reverse());let i;for(i=0;i<n.length;i+=1){const u=it(s,n,i);t[i]?t[i].p(u,o):(t[i]=at(u),t[i].c(),t[i].m(e,null))}for(;i<t.length;i+=1)t[i].d(1);t.length=n.length}},d(s){s&&h(e),pt(t,s)}}}function rt(l){let e,n=l[5].name+"",t,s;return{c(){e=E("div"),t=ae(n),s=A(),this.h()},l(o){e=N(o,"DIV",{class:!0,style:!0});var i=O(e);t=ce(i,n),s=S(i),i.forEach(h),this.h()},h(){m(e,"class","legend-item svelte-j56lk0"),Y(e,"background",l[5].color)},m(o,i){P(o,e,i),b(e,t),b(e,s)},p(o,i){i&3&&n!==(n=o[5].name+"")&&ve(t,n),i&3&&Y(e,"background",o[5].color)},d(o){o&&h(e)}}}function at(l){let e,n=l[5].checked&&rt(l);return{c(){n&&n.c(),e=ue()},l(t){n&&n.l(t),e=ue()},m(t,s){n&&n.m(t,s),P(t,e,s)},p(t,s){t[5].checked?n?n.p(t,s):(n=rt(t),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d(t){t&&h(e),n&&n.d(t)}}}function ct(l){let e,n,t="Drawer",s,o,i="Select None",u,c;return{c(){e=E("div"),n=E("button"),n.textContent=t,s=A(),o=E("button"),o.textContent=i,this.h()},l(d){e=N(d,"DIV",{id:!0});var a=O(e);n=N(a,"BUTTON",{class:!0,"data-svelte-h":!0}),le(n)!=="svelte-1d0ebnl"&&(n.textContent=t),s=S(a),o=N(a,"BUTTON",{class:!0,"data-svelte-h":!0}),le(o)!=="svelte-dxj0z0"&&(o.textContent=i),a.forEach(h),this.h()},h(){m(n,"class","svelte-j56lk0"),m(o,"class","svelte-j56lk0"),m(e,"id","matrix-btns")},m(d,a){P(d,e,a),b(e,n),b(e,s),b(e,o),u||(c=[Q(n,"click",l[2]),Q(o,"click",l[3])],u=!0)},p:J,d(d){d&&h(e),u=!1,ge(c)}}}function $l(l){let e,n,t=l[0].showLegend&&l[0].techniqueMappingMode!=="heatMap"&&l[1]&&ot(l),s=!l[0].isReadonly&&ct(l);return{c(){e=E("div"),t&&t.c(),n=A(),s&&s.c(),this.h()},l(o){e=N(o,"DIV",{id:!0,class:!0});var i=O(e);t&&t.l(i),n=S(i),s&&s.l(i),i.forEach(h),this.h()},h(){m(e,"id","container-legend"),m(e,"class","svelte-j56lk0")},m(o,i){P(o,e,i),t&&t.m(e,null),b(e,n),s&&s.m(e,null)},p(o,[i]){o[0].showLegend&&o[0].techniqueMappingMode!=="heatMap"&&o[1]?t?t.p(o,i):(t=ot(o),t.c(),t.m(e,n)):t&&(t.d(1),t=null),o[0].isReadonly?s&&(s.d(1),s=null):s?s.p(o,i):(s=ct(o),s.c(),s.m(e,null))},i:J,o:J,d(o){o&&h(e),t&&t.d(),s&&s.d()}}}function Ml(l,e,n){let t,s;oe(l,G,c=>n(0,s=c));const o=()=>{te(G,s.isDrawerOpen=!s.isDrawerOpen,s)},i=()=>{se.reset("test")},u=c=>s.measures[c.toLowerCase()];return l.$$.update=()=>{var c,d;l.$$.dirty&1&&n(1,t=(d=(c=s==null?void 0:s.portfolios)==null?void 0:c[s==null?void 0:s.selectedPortfolio])==null?void 0:d.includedMeasures)},[s,t,o,i,u]}class El extends me{constructor(e){super(),_e(this,e,Ml,$l,fe,{})}}const{window:Nl}=$t;function Il(l){let e,n;return e=new _l({props:{slot:"drawer"}}),{c(){H(e.$$.fragment)},l(t){U(e.$$.fragment,t)},m(t,s){B(e,t,s),n=!0},p:J,i(t){n||(I(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){R(e,t)}}}function Tl(l){let e,n;return e=new jt({props:{treeStore:l[2],theme:"main",slot:"matrix",scroll_indicator:!1}}),e.$on("elementClick",l[5]),{c(){H(e.$$.fragment)},l(t){U(e.$$.fragment,t)},m(t,s){B(e,t,s),n=!0},p(t,s){const o={};s&4&&(o.treeStore=t[2]),e.$set(o)},i(t){n||(I(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){R(e,t)}}}function Dl(l){let e,n;return e=new El({props:{slot:"legend"}}),{c(){H(e.$$.fragment)},l(t){U(e.$$.fragment,t)},m(t,s){B(e,t,s),n=!0},p:J,i(t){n||(I(e.$$.fragment,t),n=!0)},o(t){y(e.$$.fragment,t),n=!1},d(t){R(e,t)}}}function Ll(l){return{c:J,l:J,m:J,p:J,i:J,o:J,d:J}}function yl(l){let e,n,t=l[3]&&ut(l);return{c(){t&&t.c(),e=ue()},l(s){t&&t.l(s),e=ue()},m(s,o){t&&t.m(s,o),P(s,e,o),n=!0},p(s,o){s[3]?t?(t.p(s,o),o&8&&I(t,1)):(t=ut(s),t.c(),I(t,1),t.m(e.parentNode,e)):t&&(de(),y(t,1,1,()=>{t=null}),pe())},i(s){n||(I(t),n=!0)},o(s){y(t),n=!1},d(s){s&&h(e),t&&t.d(s)}}}function ut(l){let e,n="esc",t,s,o,i,u;return s=new qt({props:{technique_id:l[0].technique_id,technique:l[15]}}),{c(){e=E("button"),e.textContent=n,t=A(),H(s.$$.fragment)},l(c){e=N(c,"BUTTON",{"data-svelte-h":!0}),le(e)!=="svelte-10d8xzb"&&(e.textContent=n),t=S(c),U(s.$$.fragment,c)},m(c,d){P(c,e,d),P(c,t,d),B(s,c,d),o=!0,i||(u=Q(e,"click",dt(l[9])),i=!0)},p(c,d){const a={};d&1&&(a.technique_id=c[0].technique_id),d&8&&(a.technique=c[15]),s.$set(a)},i(c){o||(I(s.$$.fragment,c),o=!0)},o(c){y(s.$$.fragment,c),o=!1},d(c){c&&(h(e),h(t)),R(s,c),i=!1,u()}}}function Ol(l){let e,n="loading...";return{c(){e=E("span"),e.textContent=n},l(t){e=N(t,"SPAN",{"data-svelte-h":!0}),le(e)!=="svelte-sermp4"&&(e.textContent=n)},m(t,s){P(t,e,s)},p:J,i:J,o:J,d(t){t&&h(e)}}}function jl(l){let e,n,t,s,o,i,u,c,d,a;e=new Pt({props:{title:"Embedded D3FEND Matrix",og_title:"MITRE Embedded D3FEND Measures",og_type:"website",og_url:"https://d3fend.mitre.org/",og_image:"https://d3fend.mitre.org/img/d3fend-og.png",og_description:"D3FEND Measures Analysis."}}),s=new Cl({props:{$$slots:{legend:[Dl],matrix:[Tl],drawer:[Il]},$$scope:{ctx:l}}});let r={ctx:l,current:null,token:null,hasCatch:!1,pending:Ol,then:yl,catch:Ll,value:15,blocks:[,,,]};return Ze(u=l[3],r),{c(){H(e.$$.fragment),n=A(),t=E("main"),H(s.$$.fragment),o=A(),i=E("dialog"),r.block.c(),this.h()},l(f){U(e.$$.fragment,f),n=S(f),t=N(f,"MAIN",{});var p=O(t);U(s.$$.fragment,p),o=S(p),i=N(p,"DIALOG",{class:!0});var _=O(i);r.block.l(_),_.forEach(h),p.forEach(h),this.h()},h(){m(i,"class","technique-dialog")},m(f,p){B(e,f,p),P(f,n,p),P(f,t,p),B(s,t,null),b(t,o),b(t,i),r.block.m(i,r.anchor=null),r.mount=()=>i,r.anchor=null,l[10](i),c=!0,d||(a=[Q(Nl,"message",l[4]),Q(i,"close",l[11])],d=!0)},p(f,[p]){l=f;const _={};p&65540&&(_.$$scope={dirty:p,ctx:l}),s.$set(_),r.ctx=l,p&8&&u!==(u=l[3])&&Ze(u,r)||wt(r,l,p)},i(f){c||(I(e.$$.fragment,f),I(s.$$.fragment,f),I(r.block),c=!0)},o(f){y(e.$$.fragment,f),y(s.$$.fragment,f);for(let p=0;p<3;p+=1){const _=r.blocks[p];y(_)}c=!1},d(f){f&&(h(n),h(t)),R(e,f),R(s),r.block.d(),r.token=null,r=null,l[10](null),d=!1,ge(a)}}}function Pl(l,e,n){let t,s,o;oe(l,se,C=>n(12,t=C)),oe(l,G,C=>n(13,s=C)),oe(l,It,C=>n(8,o=C));let{data:i}=e,u,c=null,d,a;kt(()=>{if(n(2,u=Vt(G,se)),window.parent.postMessage({call:"FromParent",value:s},"*"),n(7,d=document.getElementsByTagName("body")[0]),o.url.searchParams.size){const C=o.url.search.split("=").at(-1);n(3,c=_(C)),qe(`/profile?technique_id=${C}`)}}),Tt(()=>{d==null||d.classList.remove("scroll--none")});const r=C=>{te(G,s=C.data.value,s)},f=C=>{const q=C.detail.element["@id"];if(!C.detail.event.ctrlKey&&!C.detail.event.metaKey){const $=C.detail.element["@id"];n(3,c=_($)),qe(`/profile?technique_id=${$}`);return}t.treeMap[q].classes.isSelected?(te(se,t.treeMap[q].classes.select="",t),te(se,t.treeMap[q].classes.isSelected=!1,t)):(te(se,t.treeMap[q].classes.select="3px solid red",t),te(se,t.treeMap[q].classes.isSelected=!0,t))},p=C=>{a.close(),qe("/profile")},_=async C=>{const q=await fetch(`/api/technique/${C}.json`),$=await q.json();if(q.ok)return $;throw new Error($)},L=C=>p();function v(C){he[C?"unshift":"push"](()=>{a=C,n(1,a)})}const k=C=>p();return l.$$set=C=>{"data"in C&&n(0,i=C.data)},l.$$.update=()=>{l.$$.dirty&386&&(a&&o.url.searchParams.size?(a.showModal(),d==null||d.classList.add("scroll--none")):a&&(a.close(),d==null||d.classList.remove("scroll--none")))},[i,a,u,c,r,f,p,d,o,L,v,k]}class Xl extends me{constructor(e){super(),_e(this,e,Pl,jl,fe,{data:0})}}export{Xl as component};
