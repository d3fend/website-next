import{w as M}from"./index.BaLOT0NF.js";import{c as R}from"./_createCompounder.CzaRox2e.js";var P={local:{},session:{}};function L(o){return o==="local"?localStorage:sessionStorage}function U(o,l,d){var f,j;const T=(f=d==null?void 0:d.serializer)!=null?f:JSON,k=(j=d==null?void 0:d.storage)!=null?j:"local",x=typeof window<"u"&&typeof document<"u",m=x?L(k):null;function w(v,b){m==null||m.setItem(v,T.stringify(b))}if(!P[k][o]){const v=M(l,h=>{const y=m==null?void 0:m.getItem(o);if(y&&h(T.parse(y)),x&&k=="local"){const g=A=>{A.key===o&&h(A.newValue?T.parse(A.newValue):null)};return window.addEventListener("storage",g),()=>window.removeEventListener("storage",g)}}),{subscribe:b,set:D}=v;P[k][o]={set(h){w(o,h),D(h)},update(h){return v.update(y=>{const g=h(y);return w(o,g),g})},subscribe:b}}return P[k][o]}var E=R(function(o,l,d){return o+(d?"-":"")+l.toLowerCase()});const F=()=>{let o=new Date().getTime(),l=typeof performance<"u"&&performance.now&&performance.now()*1e3||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,d=>{let f=Math.random()*16;return o>0?(f=(o+f)%16|0,o=Math.floor(o/16)):(f=(l+f)%16|0,l=Math.floor(l/16)),(d=="x"?f:f&7|8).toString(16)})};function q(o){return`${E(o)}-${F().split("-").slice(0,2).join("")}`}function Q(o,l){return o.map(d=>(d.children=d.children.map(f=>l[f]),d))}const Z=async o=>{const l=await fetch(o),d=await l.json();if(l.ok)return d;throw new Error(d)},u={layers:"layers",templates:"templates"},I={rootColor:"multiColor",heatMap:"heatMap",childrenMultiColor:"childrenMultiColor","ATT&CK":"ATT&CK"},X={attack:"attack",controls:"controls",cwe:"cwe",act:"acf"},O={version:"0.1.0",isReadonly:!1,isDrawerOpen:!0,showLegend:!0,techniqueMappingMode:I.childrenMultiColor,selectedProfile:0,selectedStore:u.layers,containerSize:.8,matrixSize:1,update:!1,localStorageWarning:!1,profiles:[{id:0,description:"Testing the description",name:"Profile 1",includedLayers:["claimed-dkjndlkdj","tested-dnkljlkldjs","integration-jksieufnvdkd"]},{id:1,description:"Testing the description",name:"Profile 2",includedLayers:["zero-trust-kdjj2mvnvjkkd"]},{id:2,description:"Testing the description",name:"Profile 3",includedLayers:["next-generation-firewall-kjlknlkn","zero-trust-kdjj2mvnvjkkd"]}],layers:{"zero-trust-kdjj2mvnvjkkd":{id:"zero-trust-kdjj2mvnvjkkd",description:"Testing the description",name:"Zero-Trust",techniques:[],color:"#ef0b0b",children:["role-based-access-hdjkfkkbvgn","least-priviledge-27kdjkdfkj","continuous-verification-jkqwwer","geo-location-ie83909"],checked:!0},"role-based-access-hdjkfkkbvgn":{id:"role-based-access-hdjkfkkbvgn",description:"Testing the description",name:"Role-Based Access",techniques:["d3f:DataInventory","d3f:ServiceDependencyMapping","d3f:AccessModeling","d3f:AssetInventory"],children:[],color:"#ef0b0b",checked:!0},"least-priviledge-27kdjkdfkj":{id:"least-priviledge-27kdjkdfkj",description:"Testing the description",name:"Least Priviledge",techniques:["d3f:DNSAllowlisting","d3f:DNSDenylisting","d3f:ForwardResolutionDomainDenylisting","d3f:HierarchicalDomainDenylisting","d3f:HomoglyphDenylisting","d3f:ForwardResolutionIPDenylisting","d3f:ReverseResolutionIPDenylisting","d3f:InboundTrafficFiltering","d3f:OutboundTrafficFiltering","d3f:AccountLocking","d3f:ProcessTermination"],color:"#ef0b0b",checked:!0,children:[]},"continuous-verification-jkqwwer":{id:"continuous-verification-jkqwwer",description:"Testing the description",name:"Continuous Verification",techniques:[],color:"#ef0b0b",children:[]},"geo-location-ie83909":{id:"geo-location-ie83909",description:"Testing the description",name:"Geo Location",techniques:["d3f:TransferAgentAuthentication","d3f:ServiceDependencyMapping","d3f:AccessModeling"],color:"#ef0b0b",children:[]},"bandwidth-control-and-monitoring-837fdrkdm":{id:"bandwidth-control-and-monitoring-837fdrkdm",description:"Testing the description",name:"Bandwidth Control and Monitoring",techniques:[],children:[],color:"#ef0b0b",checked:!0},"web-filtering-3iejkdfmv":{id:"web-filtering-3iejkdfmv",description:"Testing the description",name:"Web Filtering",techniques:[],color:"#ef0b0b",children:[]},"sandboxing-kdnvmvmmv":{id:"sandboxing-kdnvmvmmv",description:"Testing the description",name:"Sandboxing",techniques:[],color:"#ef0b0b",children:[]},"threat-prevention-kdkvsaka":{id:"threat-prevention-kdkvsaka",description:"Testing the description",name:"Threat Prevention",techniques:[],color:"#ef0b0b",children:[]},"application-and-identiy-based-inspection-dkvn":{id:"application-and-identiy-based-inspection-dkvn",description:"Testing the description",name:"Application and Identiy-based Inspection",techniques:["d3f:HomoglyphDetection","d3f:URLAnalysis","d3f:CertificateAnalysis","d3f:PassiveCertificateAnalysis","d3f:IPCTrafficAnalysis","d3f:AuthenticationEventThresholding","d3f:AuthorizationEventThresholding","d3f:DomainAccountMonitoring","d3f:JobFunctionAccessPatternAnalysis","d3f:LocalAccountMonitoring","d3f:ResourceAccessPatternAnalysis","d3f:SessionDurationAnalysis","d3f:UserDataTransferAnalysis","d3f:UserGeolocationLogonPatternAnalysis","d3f:AdministrativeNetworkActivityAnalysis","d3f:Client-serverPayloadProfiling","d3f:ConnectionAttemptAnalysis","d3f:DNSTrafficAnalysis","d3f:NetworkTrafficCommunityDeviation","d3f:PerHostDownload-UploadRatioAnalysis","d3f:ProtocolMetadataAnomalyDetection","d3f:RelayPatternAnalysis","d3f:RemoteTerminalSessionDetection","d3f:RPCTrafficAnalysis"],color:"#ef0b0b",checked:!0,children:[]},"scalability-kdnvmv":{id:"scalability-kdnvmv",description:"Testing the description",name:"Scalability",techniques:[],color:"#ef0b0b",children:[],checked:!0},"next-generation-firewall-kjlknlkn":{id:"next-generation-firewall-kjlknlkn",description:"Testing the description",name:"Next-Generation Firewall",techniques:[],color:"#ef0b0b",children:["web-filtering-3iejkdfmv","sandboxing-kdnvmvmmv","threat-prevention-kdkvsaka"]},"claimed-dkjndlkdj":{id:"claimed-dkjndlkdj",description:"Testing the description",name:"Claimed",checked:!0,techniques:[],color:"#98d0A9",children:["scalability-kdnvmv","application-and-identiy-based-inspection-dkvn"]},"tested-dnkljlkldjs":{id:"tested-dnkljlkldjs",description:"Testing the description",name:"Tested",checked:!0,techniques:["d3f:AdministrativeNetworkActivityAnalysis","d3f:Client-serverPayloadProfiling","d3f:ConnectionAttemptAnalysis","d3f:DNSTrafficAnalysis","d3f:NetworkTrafficCommunityDeviation","d3f:PerHostDownload-UploadRatioAnalysis","d3f:ProtocolMetadataAnomalyDetection","d3f:RelayPatternAnalysis","d3f:RemoteTerminalSessionDetection","d3f:RPCTrafficAnalysis"],children:[],color:"#7eec9f"},"integration-jksieufnvdkd":{id:"integration-jksieufnvdkd",description:"Testing the description",name:"Integration",techniques:[],children:["least-priviledge-27kdjkdfkj"],checked:!0,color:"#ffcc80"}},attack:{},rootTemplates:["firewall-kdjenyeurhg","threat-prevention-kdkvsaka"],templates:{"firewall-kdjenyeurhg":{id:"firewall-kdjenyeurhg",description:"Testing the description",name:"Firewall",techniques:[],scores:[0,3,4],risk:10,weight:100,checked:!0,color:"#7078A4",children:["bandwidth-control-and-monitoring-837fdrkdm"]},"bandwidth-control-and-monitoring-837fdrkdm":{id:"bandwidth-control-and-monitoring-837fdrkdm",description:"Testing the description",name:"Bandwidth Control and Monitoring",techniques:["d3f:SoftwareUpdate","d3f:ByteSequenceEmulation","d3f:JobFunctionAccessPatternAnalysis","d3f:NetworkTrafficFiltering"],children:[],color:"#7078A4",checked:!0},"web-filtering-3iejkdfmv":{id:"web-filtering-3iejkdfmv",name:"Web Filtering",description:"Testing the description",techniques:[],children:[],color:"#7078A4",checked:!0},"sandboxing-kdnvmvmmv":{id:"sandboxing-kdnvmvmmv",description:"Testing the description",name:"Sandboxing",techniques:[],children:[],checked:!0,color:"#BB5883"},"threat-prevention-kdkvsaka":{id:"threat-prevention-kdkvsaka",name:"Threat Prevention",description:"Testing the description",techniques:[],children:[],color:"#BB5883",checked:!0}},shownTactics:{"d3f:Model":!1,"d3f:Harden":!1,"d3f:Detect":!1,"d3f:Isolate":!1,"d3f:Deceive":!1,"d3f:Evict":!1}},S={selected:"selected",editing:"editing",parent:"parent",root:"root",noop:"noop",void:null},z=o=>{const{subscribe:l,update:d,set:f}=U("d3fend-layers",o);return{subscribe:l,update:d,set:f,createProfile:i=>d(e=>{const t=e.profiles.length;return i.id=t,i.includedLayers=[],e.profiles.push(i),e.selectedProfile=t,e}),deleteProfile:()=>d(i=>(i.profiles=i.profiles.filter((e,t)=>t!==i.selectedProfile),i.selectedProfile=i.profiles.length?0:null,i)),addLayer:i=>d(e=>(e.layers[i.id]=i,e.profiles[e.selectedProfile].includedLayers.push(i.id),e)),bulkAddLayer:(i,e)=>d(t=>{for(const n of i)t.layers[n.id]=n;return t.profiles[t.selectedProfile].includedLayers.push(e),t}),addTemplate:i=>d(e=>(e.templates[i.id]=i,e.rootTemplates.push(i.id),e)),copyFromTemplate:(i,e=u.layers)=>d(t=>(i.id=q(i.name),t[e][i.id]=i,t)),appendLayer:i=>d(e=>(e.layers[i]&&e.profiles[e.selectedProfile].includedLayers.push(i),e)),editName:(i,e,t=u.layers)=>d(n=>(n[t][i].name=e,n)),editDescription:(i,e,t=u.layers)=>d(n=>(n[t][i].description=e,n)),addChild:(i,e,t=u.layers)=>d(n=>{const s=q(e.name),a=i.id;return e.id=s,e.checked=!0,e.children=[],e.techniques=[...i.techniques],e.color=i.color,n[t][s]=e,n[t][a].children||(n[t][a].children=[]),n[t][a].children.push(s),n[t][a].techniques=[],n}),addNonRootChild:(i,e,t=u.layers)=>d(n=>{const s=q(e.name);return e.id=s,e.checked=!0,e.techniques=[],e.children=[],e.color=i.color,n[t][s]=e,n[t][i.id].children.push(s),n}),deleteLayer:i=>d(e=>{const{[i]:t,...n}=e.layers,s=e.profiles.reduce((a,r,c)=>{if(e.selectedProfile===c){const p={...r,includedLayers:r.includedLayers.filter(C=>C!==i)};a.push(p)}else a.push(r);return a},[]);return{...e,profiles:s,layers:n}}),deleteTemplate:i=>d(e=>{const{[i]:t,...n}=e.templates,s=e.rootTemplates.filter(a=>i!==a);return{...e,templates:n,rootTemplates:s}}),deleteSublayer:(i,e,t=u.layers)=>d(n=>(n[t][e].children=n[t][e].children.filter(s=>s!==i.id),delete n[t][i.id],n)),saveTechniques:(i,e,t=u.layers)=>d(n=>{const s=Object.values(i).reduce((r,c)=>(c.classes.isSelected&&r.push(c["@id"]),r),[]);return Object.entries(e).reduce((r,[c,p])=>(p===S.selected&&r.push(c),r),[]).forEach(r=>{const c=[...new Set([...n[t][r].techniques,...s])];n[t][r].techniques=c,n[t][r].checked=!0}),n}),removeTechniques:(i,e,t=u.layers)=>d(n=>{const s=Object.values(i).reduce((r,c)=>(c.classes.isSelected&&r.push(c["@id"]),r),[]);return Object.entries(e).reduce((r,[c,p])=>(p===S.selected&&r.push(c),r),[]).forEach(r=>{const c=n[t][r].techniques.filter(p=>!s.includes(p));n[t][r].techniques=c,n[t][r].checked=!0}),n}),saveLayerColor:(i,e,t=u.layers)=>d(n=>(n[t][i.id].color=e,n)),changeTechniqueMappingMode:(i,e)=>d(t=>(t.techniqueMappingMode=i,t.showLegend=e,t)),addUserAssociatedAttack:(i,e,t)=>d(n=>{if((n.attack[i]||(n.attack[i]={}))&&(n.attack[i][e]||(n.attack[i][e]=[]))){const s=`${t.id}${t.tactic}`;if(n.attack[i][e].findIndex(({id:r,tactic:c})=>`${r}${c}`===s)!==-1)return n;n.attack[i][e].push(t)}return n}),editUserAssociatedAttack:(i,e,t)=>d(n=>(n.attack[i][e].justification=t,n)),deleteUserAssociatedAttack:(i,e,t)=>d(n=>{const s=n.attack[i][e].reduce((a,r)=>(r.id!==t&&a.push(r),a),[]);return n.attack[i][e]=s,n})}},Y=z(O);export{I as M,u as P,S,X as T,q as c,Z as f,Y as l,Q as m};
