const J={crush:(l,s=50)=>{const u="",p=(e,h)=>{let g=h.length,w="";const m=t=>encodeURI(encodeURIComponent(t)).replace(/%../g,"i").length,F=t=>{let o=t.charCodeAt(0),c=t.charCodeAt(t.length-1);return o>=56320&&o<=57343||c>=55296&&c<=56319};let f={};for(let t=2;t<s;t++)for(let o=0;o<e.length-t;++o){let c=e.substr(o,t);if(f[c]||F(c))continue;let x=1;for(let d=e.indexOf(c,o+t);d>=0;++x)d=e.indexOf(c,d+t);x>1&&(f[c]=x)}for(;;){for(;g--&&e.includes(h[g]););if(g<0)break;let t=h[g],o,c=0,x=m(t);for(let b in f){let a=f[b],i=(a-1)*m(b)-(a+1)*x;w.length||(i-=m(u)),i<=0?delete f[b]:i>c&&(o=b,c=i)}if(!o)break;e=e.split(o).join(t)+t+o,w=t+w;let d={};for(let b in f){let a=b.split(o).join(t),i=0;for(let D=e.indexOf(a);D>=0;++i)D=e.indexOf(a,D+a.length);i>1&&(d[a]=i)}f=d}return{a:e,b:w}};let n=[];const r="-_.!~*'()";for(let e=127;--e;)(e>=48&&e<=57||e>=65&&e<=90||e>=97&&e<=122||r.includes(String.fromCharCode(e)))&&n.push(String.fromCharCode(e));for(let e=32;e<255;++e){let h=String.fromCharCode(e);h!="\\"&&!n.includes(h)&&n.unshift(h)}l=l.replace(new RegExp(u,"g"),""),l=O(l);const C=p(l,n);let S=C.a;return C.b.length&&(S+=u+C.b),S+="_",S},uncrush:l=>{l=l.substring(0,l.length-1);const s=l.split("");let u=s[0];if(s.length>1){let p=s[1];for(let n of p){let r=u.split(n);u=r.join(r.pop())}}return O(u,0)}},O=(l,s=1)=>{const u=[['"',"'"],["':","!"],[",'","~"],["}",")","\\","\\"],["{","(","\\","\\"]],p=(n,r)=>{let C=new RegExp(`${(r[2]?r[2]:"")+r[0]}|${(r[3]?r[3]:"")+r[1]}`,"g");return n.replace(C,S=>S===r[0]?r[1]:r[0])};if(s)for(let n=0;n<u.length;++n)l=p(l,u[n]);else for(let n=u.length;n--;)l=p(l,u[n]);return l};export{J};
